variables:
  RISCV: /usr/local/rv/

install_spike:
  stage: build
  image: ubuntu:latest
  script:
    - apt-get update && apt-get install git gcc -y
    - apt-get install build-essential device-tree-compiler -y
    - git clone https://github.com/riscv-software-src/riscv-isa-sim.git
    - cd riscv-isa-sim
    - mkdir build && cd build
    - ../configure --prefix=$RISCV
    - make install
    - export PATH=$PATH:$RISCV

build_tests:
  stage: build
  image: ubuntu:latest
  script:
    - apt-get update
    - apt-get install gcc-riscv64-unknown-elf clang make -y
    - make setup dump
  artifacts:
    paths:
      - target/
    when: on_success
    expire_in: 30 days
  
run_tests:
  stage: test
  image: ubuntu:latest
  script:
    - make test
  artifacts:
    paths:
      - log/
    when: on_failure
    expire_in: 30 days

stages:
- tooling
- build
- test

include:
  # Secret Detection customization: https://docs.gitlab.com/ee/user/application_security/secret_detection/#customizing-settings
  - template: Security/Secret-Detection.gitlab-ci.yml
