variables:
  RISCV: /usr/local/rv/

install_spike:
  stage: tooling
  image: ubuntu:latest
  script:
    - apt-get update && apt-get install git gcc -y
    - apt-get install build-essential device-tree-compiler -y
    - git clone https://github.com/riscv-software-src/riscv-isa-sim.git
    - cd riscv-isa-sim
    - mkdir build && cd build
    - ../configure --prefix=$RISCV
    - export PATH=$PATH:$RISCV
    - make install
    - cd ~ && spike

install_clang:
  stage: tooling
  image: ubuntu:latest
  script:
    - apt-get update
    - apt-get install gcc-riscv64-unknown-elf -y

run_tests:
  stage: test
  image: ubuntu:latest
  script:
    - make

stages:
- tooling
- build
- test

include:
  # Secret Detection customization: https://docs.gitlab.com/ee/user/application_security/secret_detection/#customizing-settings
  - template: Security/Secret-Detection.gitlab-ci.yml
