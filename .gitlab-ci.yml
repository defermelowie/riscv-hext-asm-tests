variables:
  RISCV: /usr/local/rv/

build_spike:
  stage: build
  image: ubuntu:latest
  script:
    - apt-get update
    - apt-get install gcc make git build-essential device-tree-compiler -y
    - git clone https://github.com/riscv-software-src/riscv-isa-sim.git
    - cd riscv-isa-sim
    - mkdir build && cd build
    - ../configure
    - make
  cache:
    key: spike
    paths:
      - riscv-isa-sim/build/spike
    when: on_success
  artifacts:
    paths:
      - riscv-isa-sim/build/spike
    when: on_success

build_tests:
  stage: build
  image: ubuntu:latest
  script:
    - apt-get update
    - apt-get install gcc-riscv64-unknown-elf clang make git -y
    - git submodule init && git submodule update
    - make setup dump
  artifacts:
    paths:
      - target/
    expire_in: 30 days
  
run_tests:
  stage: test
  image: ubuntu:latest
  script:
    - make setup
    - ./riscv-isa-sim/build/spike -l --log-commits --log=log/slat_VS_VU.spike.log --isa=RV64gh target/slat_VS_VU.elf
  artifacts:
    paths:
      - log/
    expire_in: 30 days

stages:
- build
- test

include:
  # Secret Detection customization: https://docs.gitlab.com/ee/user/application_security/secret_detection/#customizing-settings
  - template: Security/Secret-Detection.gitlab-ci.yml
