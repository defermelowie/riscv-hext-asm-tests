variables:
  GIT_SUBMODULE_STRATEGY: recursive

build_tests:
  stage: build
  image: registry.gitlab.kuleuven.be/u0165022/riscv-ci-env/toolchain:latest
  variables:
    RISCV_SVADU: "true"
  script:
    - make setup
    - make dump CC="clang --target=riscv64"
  artifacts:
    paths:
      - target/*.elf
      - target/*.dump
    expire_in: 7 days

verif_tests_spike:
  stage: test
  image: registry.gitlab.kuleuven.be/u0165022/riscv-ci-env/spike:latest
  needs:
    - build_tests
  script:
    - make setup
    - make spike
  artifacts:
    when: always
    paths:
      - "log/*.log"
    expire_in: 7 days

stages:
- build
- test

include:
  # Secret Detection customization: https://docs.gitlab.com/ee/user/application_security/secret_detection/#customizing-settings
  - template: Security/Secret-Detection.gitlab-ci.yml
