<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>riscv_sys_regs</title></head>
<body>
<h1>riscv_sys_regs.sail (101/258) 39%</h1>
<code style="display: block">
/*=======================================================================================*/<br>
/*&nbsp;&nbsp;RISCV&nbsp;Sail&nbsp;Model&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;This&nbsp;Sail&nbsp;RISC-V&nbsp;architecture&nbsp;model,&nbsp;comprising&nbsp;all&nbsp;files&nbsp;and&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;directories&nbsp;except&nbsp;for&nbsp;the&nbsp;snapshots&nbsp;of&nbsp;the&nbsp;Lem&nbsp;and&nbsp;Sail&nbsp;libraries&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;in&nbsp;the&nbsp;prover_snapshots&nbsp;directory&nbsp;(which&nbsp;include&nbsp;copies&nbsp;of&nbsp;their&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;licences),&nbsp;is&nbsp;subject&nbsp;to&nbsp;the&nbsp;BSD&nbsp;two-clause&nbsp;licence&nbsp;below.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;Copyright&nbsp;(c)&nbsp;2017-2023&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Prashanth&nbsp;Mundkur&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Rishiyur&nbsp;S.&nbsp;Nikhil&nbsp;and&nbsp;Bluespec,&nbsp;Inc.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Jon&nbsp;French&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Brian&nbsp;Campbell&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Robert&nbsp;Norton-Wright&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Alasdair&nbsp;Armstrong&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Thomas&nbsp;Bauereiss&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Shaked&nbsp;Flur&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Christopher&nbsp;Pulte&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Peter&nbsp;Sewell&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Alexander&nbsp;Richardson&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Hesham&nbsp;Almatary&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Jessica&nbsp;Clarke&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Microsoft,&nbsp;for&nbsp;contributions&nbsp;by&nbsp;Robert&nbsp;Norton-Wright&nbsp;and&nbsp;Nathaniel&nbsp;Wesley&nbsp;Filardo&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Peter&nbsp;Rugg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Aril&nbsp;Computer&nbsp;Corp.,&nbsp;for&nbsp;contributions&nbsp;by&nbsp;Scott&nbsp;Johnson&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;Philipp&nbsp;Tomsich&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;VRULL&nbsp;GmbH,&nbsp;for&nbsp;contributions&nbsp;by&nbsp;its&nbsp;employees&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;This&nbsp;software&nbsp;was&nbsp;developed&nbsp;by&nbsp;the&nbsp;above&nbsp;within&nbsp;the&nbsp;Rigorous&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;Engineering&nbsp;of&nbsp;Mainstream&nbsp;Systems&nbsp;(REMS)&nbsp;project,&nbsp;partly&nbsp;funded&nbsp;by&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;EPSRC&nbsp;grant&nbsp;EP/K008528/1,&nbsp;at&nbsp;the&nbsp;Universities&nbsp;of&nbsp;Cambridge&nbsp;and&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;Edinburgh.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;This&nbsp;software&nbsp;was&nbsp;developed&nbsp;by&nbsp;SRI&nbsp;International&nbsp;and&nbsp;the&nbsp;University&nbsp;of&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;Cambridge&nbsp;Computer&nbsp;Laboratory&nbsp;(Department&nbsp;of&nbsp;Computer&nbsp;Science&nbsp;and&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;Technology)&nbsp;under&nbsp;DARPA/AFRL&nbsp;contract&nbsp;FA8650-18-C-7809&nbsp;(&quot;CIFV&quot;),&nbsp;and&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;under&nbsp;DARPA&nbsp;contract&nbsp;HR0011-18-C-0016&nbsp;(&quot;ECATS&quot;)&nbsp;as&nbsp;part&nbsp;of&nbsp;the&nbsp;DARPA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;SSITH&nbsp;research&nbsp;programme.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;This&nbsp;project&nbsp;has&nbsp;received&nbsp;funding&nbsp;from&nbsp;the&nbsp;European&nbsp;Research&nbsp;Council&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;(ERC)&nbsp;under&nbsp;the&nbsp;European&nbsp;Unionâ€™s&nbsp;Horizon&nbsp;2020&nbsp;research&nbsp;and&nbsp;innovation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;programme&nbsp;(grant&nbsp;agreement&nbsp;789108,&nbsp;ELVER).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;Redistribution&nbsp;and&nbsp;use&nbsp;in&nbsp;source&nbsp;and&nbsp;binary&nbsp;forms,&nbsp;with&nbsp;or&nbsp;without&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;modification,&nbsp;are&nbsp;permitted&nbsp;provided&nbsp;that&nbsp;the&nbsp;following&nbsp;conditions&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;are&nbsp;met:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;1.&nbsp;Redistributions&nbsp;of&nbsp;source&nbsp;code&nbsp;must&nbsp;retain&nbsp;the&nbsp;above&nbsp;copyright&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;notice,&nbsp;this&nbsp;list&nbsp;of&nbsp;conditions&nbsp;and&nbsp;the&nbsp;following&nbsp;disclaimer.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;2.&nbsp;Redistributions&nbsp;in&nbsp;binary&nbsp;form&nbsp;must&nbsp;reproduce&nbsp;the&nbsp;above&nbsp;copyright&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;notice,&nbsp;this&nbsp;list&nbsp;of&nbsp;conditions&nbsp;and&nbsp;the&nbsp;following&nbsp;disclaimer&nbsp;in&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;documentation&nbsp;and/or&nbsp;other&nbsp;materials&nbsp;provided&nbsp;with&nbsp;the&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;distribution.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;THIS&nbsp;SOFTWARE&nbsp;IS&nbsp;PROVIDED&nbsp;BY&nbsp;THE&nbsp;AUTHOR&nbsp;AND&nbsp;CONTRIBUTORS&nbsp;``AS&nbsp;IS''&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;AND&nbsp;ANY&nbsp;EXPRESS&nbsp;OR&nbsp;IMPLIED&nbsp;WARRANTIES,&nbsp;INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;TO,&nbsp;THE&nbsp;IMPLIED&nbsp;WARRANTIES&nbsp;OF&nbsp;MERCHANTABILITY&nbsp;AND&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;PARTICULAR&nbsp;PURPOSE&nbsp;ARE&nbsp;DISCLAIMED.&nbsp;&nbsp;IN&nbsp;NO&nbsp;EVENT&nbsp;SHALL&nbsp;THE&nbsp;AUTHOR&nbsp;OR&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;CONTRIBUTORS&nbsp;BE&nbsp;LIABLE&nbsp;FOR&nbsp;ANY&nbsp;DIRECT,&nbsp;INDIRECT,&nbsp;INCIDENTAL,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;SPECIAL,&nbsp;EXEMPLARY,&nbsp;OR&nbsp;CONSEQUENTIAL&nbsp;DAMAGES&nbsp;(INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;LIMITED&nbsp;TO,&nbsp;PROCUREMENT&nbsp;OF&nbsp;SUBSTITUTE&nbsp;GOODS&nbsp;OR&nbsp;SERVICES;&nbsp;LOSS&nbsp;OF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;USE,&nbsp;DATA,&nbsp;OR&nbsp;PROFITS;&nbsp;OR&nbsp;BUSINESS&nbsp;INTERRUPTION)&nbsp;HOWEVER&nbsp;CAUSED&nbsp;AND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;ON&nbsp;ANY&nbsp;THEORY&nbsp;OF&nbsp;LIABILITY,&nbsp;WHETHER&nbsp;IN&nbsp;CONTRACT,&nbsp;STRICT&nbsp;LIABILITY,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;OR&nbsp;TORT&nbsp;(INCLUDING&nbsp;NEGLIGENCE&nbsp;OR&nbsp;OTHERWISE)&nbsp;ARISING&nbsp;IN&nbsp;ANY&nbsp;WAY&nbsp;OUT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;OF&nbsp;THE&nbsp;USE&nbsp;OF&nbsp;THIS&nbsp;SOFTWARE,&nbsp;EVEN&nbsp;IF&nbsp;ADVISED&nbsp;OF&nbsp;THE&nbsp;POSSIBILITY&nbsp;OF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*&nbsp;&nbsp;SUCH&nbsp;DAMAGE.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br>
/*=======================================================================================*/<br>
<br>
/*&nbsp;Machine-mode&nbsp;and&nbsp;supervisor-mode&nbsp;state&nbsp;definitions.&nbsp;*/<br>
<br>
/*&nbsp;privilege&nbsp;level&nbsp;*/<br>
<br>
register&nbsp;cur_privilege&nbsp;:&nbsp;Privilege<br>
<br>
/*&nbsp;State&nbsp;projections<br>
&nbsp;*<br>
&nbsp;*&nbsp;Some&nbsp;machine&nbsp;state&nbsp;is&nbsp;processed&nbsp;via&nbsp;projections&nbsp;from&nbsp;machine-mode&nbsp;views&nbsp;to<br>
&nbsp;*&nbsp;views&nbsp;from&nbsp;lower&nbsp;privilege&nbsp;levels.&nbsp;&nbsp;So,&nbsp;for&nbsp;e.g.&nbsp;when&nbsp;mstatus&nbsp;is&nbsp;read&nbsp;from<br>
&nbsp;*&nbsp;lower&nbsp;privilege&nbsp;levels,&nbsp;we&nbsp;use&nbsp;'lowering_'&nbsp;projections:<br>
&nbsp;*<br>
&nbsp;*&nbsp;&nbsp;&nbsp;mstatus&nbsp;&nbsp;-&gt;&nbsp;&nbsp;sstatus&nbsp;&nbsp;-&gt;&nbsp;&nbsp;ustatus<br>
&nbsp;*<br>
&nbsp;*&nbsp;Similarly,&nbsp;when&nbsp;machine&nbsp;state&nbsp;is&nbsp;written&nbsp;from&nbsp;lower&nbsp;privileges,&nbsp;that&nbsp;state&nbsp;is<br>
&nbsp;*&nbsp;lifted&nbsp;into&nbsp;the&nbsp;appropriate&nbsp;value&nbsp;for&nbsp;the&nbsp;machine-mode&nbsp;state.<br>
&nbsp;*<br>
&nbsp;*&nbsp;&nbsp;&nbsp;ustatus&nbsp;&nbsp;-&gt;&nbsp;&nbsp;sstatus&nbsp;&nbsp;-&gt;&nbsp;&nbsp;mstatus<br>
&nbsp;*<br>
&nbsp;*&nbsp;In&nbsp;addition,&nbsp;several&nbsp;fields&nbsp;in&nbsp;machine&nbsp;state&nbsp;registers&nbsp;are&nbsp;WARL&nbsp;or&nbsp;WLRL,<br>
&nbsp;*&nbsp;requiring&nbsp;that&nbsp;values&nbsp;written&nbsp;to&nbsp;the&nbsp;registers&nbsp;be&nbsp;legalized.&nbsp;&nbsp;For&nbsp;each&nbsp;such<br>
&nbsp;*&nbsp;register,&nbsp;there&nbsp;will&nbsp;be&nbsp;an&nbsp;associated&nbsp;'legalize_'&nbsp;function.&nbsp;&nbsp;These&nbsp;functions<br>
&nbsp;*&nbsp;will&nbsp;need&nbsp;to&nbsp;be&nbsp;supplied&nbsp;externally,&nbsp;and&nbsp;will&nbsp;depend&nbsp;on&nbsp;the&nbsp;legal&nbsp;values<br>
&nbsp;*&nbsp;supported&nbsp;by&nbsp;a&nbsp;platform/implementation&nbsp;(or&nbsp;misa).&nbsp;&nbsp;The&nbsp;legalize_&nbsp;functions<br>
&nbsp;*&nbsp;generate&nbsp;a&nbsp;legal&nbsp;value&nbsp;from&nbsp;the&nbsp;current&nbsp;value&nbsp;and&nbsp;the&nbsp;written&nbsp;value.&nbsp;&nbsp;In&nbsp;more<br>
&nbsp;*&nbsp;complex&nbsp;cases,&nbsp;they&nbsp;will&nbsp;also&nbsp;implicitly&nbsp;read&nbsp;the&nbsp;current&nbsp;values&nbsp;of&nbsp;misa,<br>
&nbsp;*&nbsp;mstatus,&nbsp;etc.<br>
&nbsp;*<br>
&nbsp;*&nbsp;Each&nbsp;register&nbsp;definition&nbsp;below&nbsp;is&nbsp;followed&nbsp;by&nbsp;custom&nbsp;projections<br>
&nbsp;*&nbsp;and&nbsp;choice&nbsp;of&nbsp;legalizations&nbsp;if&nbsp;needed.&nbsp;&nbsp;For&nbsp;now,&nbsp;we&nbsp;typically<br>
&nbsp;*&nbsp;implement&nbsp;the&nbsp;simplest&nbsp;legalize_&nbsp;alternatives.<br>
&nbsp;*/<br>
<br>
<br>
/*&nbsp;M-mode&nbsp;registers&nbsp;*/<br>
<br>
bitfield&nbsp;Misa&nbsp;:&nbsp;xlenbits&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;MXL&nbsp;&nbsp;:&nbsp;xlen&nbsp;-&nbsp;1&nbsp;..&nbsp;xlen&nbsp;-&nbsp;2,<br>
<br>
&nbsp;&nbsp;Z&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;25,<br>
&nbsp;&nbsp;Y&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;24,<br>
&nbsp;&nbsp;X&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;23,<br>
&nbsp;&nbsp;W&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;22,<br>
&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;21,<br>
&nbsp;&nbsp;U&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;20,<br>
&nbsp;&nbsp;T&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;19,<br>
&nbsp;&nbsp;S&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;18,<br>
&nbsp;&nbsp;R&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;17,<br>
&nbsp;&nbsp;Q&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;16,<br>
&nbsp;&nbsp;P&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;15,<br>
&nbsp;&nbsp;O&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;14,<br>
&nbsp;&nbsp;N&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;13,<br>
&nbsp;&nbsp;M&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;12,<br>
&nbsp;&nbsp;L&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;11,<br>
&nbsp;&nbsp;K&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;10,<br>
&nbsp;&nbsp;J&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;9,<br>
&nbsp;&nbsp;I&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;8,<br>
&nbsp;&nbsp;H&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;7,<br>
&nbsp;&nbsp;G&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;6,<br>
&nbsp;&nbsp;F&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;5,<br>
&nbsp;&nbsp;E&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;4,<br>
&nbsp;&nbsp;D&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;3,<br>
&nbsp;&nbsp;C&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;2,<br>
&nbsp;&nbsp;B&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;1,<br>
&nbsp;&nbsp;A&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;0<br>
}<br>
register&nbsp;misa&nbsp;:&nbsp;Misa<br>
<br>
/*&nbsp;whether&nbsp;misa&nbsp;is&nbsp;R/W&nbsp;*/<br>
val&nbsp;sys_enable_writable_misa&nbsp;=&nbsp;{c:&nbsp;&quot;sys_enable_writable_misa&quot;,&nbsp;ocaml:&nbsp;&quot;Platform.enable_writable_misa&quot;,&nbsp;_:&nbsp;&quot;sys_enable_writable_misa&quot;}&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;bool<br>
/*&nbsp;whether&nbsp;misa.c&nbsp;was&nbsp;enabled&nbsp;at&nbsp;boot&nbsp;*/<br>
val&nbsp;sys_enable_rvc&nbsp;=&nbsp;{c:&nbsp;&quot;sys_enable_rvc&quot;,&nbsp;ocaml:&nbsp;&quot;Platform.enable_rvc&quot;,&nbsp;_:&nbsp;&quot;sys_enable_rvc&quot;}&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;bool<br>
/*&nbsp;whether&nbsp;misa.{f,d}&nbsp;were&nbsp;enabled&nbsp;at&nbsp;boot&nbsp;*/<br>
val&nbsp;sys_enable_fdext&nbsp;=&nbsp;{c:&nbsp;&quot;sys_enable_fdext&quot;,&nbsp;ocaml:&nbsp;&quot;Platform.enable_fdext&quot;,&nbsp;_:&nbsp;&quot;sys_enable_fdext&quot;}&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;bool<br>
/*&nbsp;whether&nbsp;zfinx&nbsp;was&nbsp;enabled&nbsp;at&nbsp;boot&nbsp;*/<br>
val&nbsp;sys_enable_zfinx&nbsp;=&nbsp;{c:&nbsp;&quot;sys_enable_zfinx&quot;,&nbsp;ocaml:&nbsp;&quot;Platform.enable_zfinx&quot;,&nbsp;_:&nbsp;&quot;sys_enable_zfinx&quot;}&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;bool<br>
/*&nbsp;whether&nbsp;the&nbsp;N&nbsp;extension&nbsp;was&nbsp;enabled&nbsp;at&nbsp;boot&nbsp;*/<br>
val&nbsp;sys_enable_next&nbsp;=&nbsp;{c:&nbsp;&quot;sys_enable_next&quot;,&nbsp;ocaml:&nbsp;&quot;Platform.enable_next&quot;,&nbsp;_:&nbsp;&quot;sys_enable_next&quot;}&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;bool<br>
/*&nbsp;whether&nbsp;the&nbsp;H&nbsp;extensions&nbsp;was&nbsp;enabled&nbsp;at&nbsp;boot&nbsp;*/<br>
val&nbsp;sys_enable_hext&nbsp;=&nbsp;{c:&nbsp;&quot;sys_enable_hext&quot;,&nbsp;ocaml:&nbsp;&quot;Platform.enable_hext&quot;,&nbsp;_:&nbsp;&quot;sys_enable_hext&quot;}&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;bool<br>
/*&nbsp;Whether&nbsp;FIOM&nbsp;bit&nbsp;of&nbsp;menvcfg/senvcfg&nbsp;is&nbsp;enabled.&nbsp;It&nbsp;must&nbsp;be&nbsp;enabled&nbsp;if<br>
&nbsp;&nbsp;&nbsp;supervisor&nbsp;mode&nbsp;is&nbsp;implemented&nbsp;and&nbsp;non-bare&nbsp;addressing&nbsp;modes&nbsp;are&nbsp;supported.&nbsp;*/<br>
val&nbsp;sys_enable_writable_fiom&nbsp;=&nbsp;{c:&nbsp;&quot;sys_enable_writable_fiom&quot;,&nbsp;ocaml:&nbsp;&quot;Platform.enable_writable_fiom&quot;,&nbsp;_:&nbsp;&quot;sys_enable_writable_fiom&quot;}&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;bool<br>
/*&nbsp;whether&nbsp;misa.v&nbsp;was&nbsp;enabled&nbsp;at&nbsp;boot&nbsp;*/<br>
val&nbsp;sys_enable_vext&nbsp;=&nbsp;{c:&nbsp;&quot;sys_enable_vext&quot;,&nbsp;ocaml:&nbsp;&quot;Platform.enable_vext&quot;,&nbsp;_:&nbsp;&quot;sys_enable_vext&quot;}&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;bool<br>
<br>
/*&nbsp;This&nbsp;function&nbsp;allows&nbsp;an&nbsp;extension&nbsp;to&nbsp;veto&nbsp;a&nbsp;write&nbsp;to&nbsp;Misa<br>
&nbsp;&nbsp;&nbsp;if&nbsp;it&nbsp;would&nbsp;violate&nbsp;an&nbsp;alignment&nbsp;restriction&nbsp;on<br>
&nbsp;&nbsp;&nbsp;unsetting&nbsp;C.&nbsp;If&nbsp;it&nbsp;returns&nbsp;true&nbsp;the&nbsp;write&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.&nbsp;*/<br>
val&nbsp;ext_veto_disable_C&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;bool<br>
<br>
function&nbsp;legalize_misa(m&nbsp;:&nbsp;Misa,&nbsp;v&nbsp;:&nbsp;xlenbits)&nbsp;-&gt;&nbsp;Misa&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;&nbsp;v&nbsp;=&nbsp;Mk_Misa(v);<br>
&nbsp;&nbsp;/*&nbsp;Suppress&nbsp;updates&nbsp;to&nbsp;MISA&nbsp;if&nbsp;MISA&nbsp;is&nbsp;not&nbsp;writable&nbsp;or&nbsp;if&nbsp;by&nbsp;disabling&nbsp;C&nbsp;next&nbsp;PC&nbsp;would&nbsp;become&nbsp;misaligned&nbsp;or&nbsp;an&nbsp;extension&nbsp;vetoes&nbsp;*/<br>
&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 75%)">if&nbsp;&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 70%)">not(sys_enable_writable_misa())&nbsp;|&nbsp;(<span style="background-color: hsl(0, 85%, 65%)">v.C()&nbsp;==&nbsp;0b0&nbsp;&&nbsp;(<span style="background-color: hsl(0, 85%, 60%)">nextPC[1]&nbsp;==&nbsp;bitone&nbsp;|&nbsp;ext_veto_disable_C()</span>)</span>)</span><br>
&nbsp;&nbsp;then&nbsp;m<br>
&nbsp;&nbsp;else&nbsp;<span style="background-color: hsl(0, 85%, 70%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Suppress&nbsp;enabling&nbsp;C&nbsp;if&nbsp;C&nbsp;was&nbsp;disabled&nbsp;at&nbsp;boot&nbsp;(i.e.&nbsp;not&nbsp;supported)&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 65%)">if&nbsp;not(sys_enable_rvc())&nbsp;then&nbsp;m&nbsp;else&nbsp;<span style="background-color: hsl(0, 85%, 60%)">update_C(m,&nbsp;v.C())</span></span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Suppress&nbsp;updates&nbsp;to&nbsp;misa.{f,d}&nbsp;if&nbsp;disabled&nbsp;at&nbsp;boot&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 65%)">if&nbsp;&nbsp;&nbsp;not(sys_enable_fdext())<br>
&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;m<br>
&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;<span style="background-color: hsl(0, 85%, 60%)">update_D(update_F(m,&nbsp;v.F()),&nbsp;v.D()&nbsp;&&nbsp;v.F())</span></span><br>
&nbsp;&nbsp;}</span></span><br>
}</span><br>
<br>
/*&nbsp;helpers&nbsp;to&nbsp;check&nbsp;support&nbsp;for&nbsp;various&nbsp;extensions.&nbsp;*/<br>
/*&nbsp;we&nbsp;currently&nbsp;don't&nbsp;model&nbsp;'E',&nbsp;so&nbsp;always&nbsp;assume&nbsp;'I'.&nbsp;*/<br>
function&nbsp;haveAtomics()&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">misa.A()&nbsp;==&nbsp;0b1</span><br>
function&nbsp;haveRVC()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">misa.C()&nbsp;==&nbsp;0b1</span><br>
function&nbsp;haveMulDiv()&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">misa.M()&nbsp;==&nbsp;0b1</span><br>
function&nbsp;haveSupMode()&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">misa.S()&nbsp;==&nbsp;0b1</span><br>
function&nbsp;haveUsrMode()&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">misa.U()&nbsp;==&nbsp;0b1</span><br>
function&nbsp;haveNExt()&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">misa.N()&nbsp;==&nbsp;0b1</span><br>
function&nbsp;haveHExt()&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">misa.H()&nbsp;==&nbsp;0b1</span><br>
/*&nbsp;see&nbsp;below&nbsp;for&nbsp;F&nbsp;and&nbsp;D&nbsp;(and&nbsp;Z*inx&nbsp;counterparts)&nbsp;extension&nbsp;tests&nbsp;*/<br>
<br>
/*&nbsp;BitManip&nbsp;extension&nbsp;support.&nbsp;*/<br>
function&nbsp;haveZba()&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;true<br>
function&nbsp;haveZbb()&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;true<br>
function&nbsp;haveZbc()&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;true<br>
function&nbsp;haveZbs()&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;true<br>
<br>
/*&nbsp;Zfa&nbsp;(additional&nbsp;FP)&nbsp;extension&nbsp;*/<br>
function&nbsp;haveZfa()&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;true<br>
<br>
/*&nbsp;Scalar&nbsp;Cryptography&nbsp;extensions&nbsp;support.&nbsp;*/<br>
function&nbsp;haveZbkb()&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;true<br>
function&nbsp;haveZbkc()&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;true<br>
function&nbsp;haveZbkx()&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;true<br>
<br>
/*&nbsp;Cryptography&nbsp;extension&nbsp;support.&nbsp;Note&nbsp;these&nbsp;will&nbsp;need&nbsp;updating&nbsp;once&nbsp;*/<br>
/*&nbsp;Sail&nbsp;can&nbsp;be&nbsp;dynamically&nbsp;configured&nbsp;with&nbsp;different&nbsp;extension&nbsp;support&nbsp;*/<br>
/*&nbsp;and&nbsp;have&nbsp;dynamic&nbsp;changes&nbsp;of&nbsp;XLEN&nbsp;via&nbsp;S/UXL&nbsp;*/<br>
function&nbsp;haveZkr()&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;true<br>
function&nbsp;haveZksh()&nbsp;&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;true<br>
function&nbsp;haveZksed()&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;true<br>
function&nbsp;haveZknh()&nbsp;&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;true<br>
function&nbsp;haveZkne()&nbsp;&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;true<br>
function&nbsp;haveZknd()&nbsp;&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;true<br>
<br>
function&nbsp;haveZmmul()&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;true<br>
<br>
/*&nbsp;Zicond&nbsp;extension&nbsp;support&nbsp;*/<br>
function&nbsp;haveZicond()&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;true<br>
<br>
bitfield&nbsp;Mstatush&nbsp;:&nbsp;bits(32)&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;MPV&nbsp;&nbsp;:&nbsp;7,<br>
&nbsp;&nbsp;GVA&nbsp;&nbsp;:&nbsp;6,<br>
&nbsp;&nbsp;MBE&nbsp;&nbsp;:&nbsp;5,<br>
&nbsp;&nbsp;SBE&nbsp;&nbsp;:&nbsp;4<br>
}<br>
register&nbsp;mstatush&nbsp;:&nbsp;Mstatush<br>
<br>
bitfield&nbsp;Mstatus&nbsp;:&nbsp;xlenbits&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;SD&nbsp;&nbsp;&nbsp;:&nbsp;xlen&nbsp;-&nbsp;1,<br>
<br>
&nbsp;&nbsp;//&nbsp;These&nbsp;fields&nbsp;are&nbsp;in&nbsp;mstatus&nbsp;in&nbsp;RV64&nbsp;and&nbsp;absent&nbsp;in&nbsp;RV32.<br>
&nbsp;&nbsp;//&nbsp;On&nbsp;RV32,&nbsp;they&nbsp;are&nbsp;in&nbsp;mstatush,&nbsp;which&nbsp;doesn't&nbsp;exist&nbsp;in&nbsp;RV64.&nbsp;&nbsp;For&nbsp;now,<br>
&nbsp;&nbsp;//&nbsp;they&nbsp;are&nbsp;handled&nbsp;in&nbsp;an&nbsp;ad-hoc&nbsp;way.<br>
&nbsp;&nbsp;//&nbsp;MPV&nbsp;&nbsp;:&nbsp;39,<br>
&nbsp;&nbsp;//&nbsp;GVA&nbsp;&nbsp;:&nbsp;38,<br>
&nbsp;&nbsp;//&nbsp;MBE&nbsp;&nbsp;:&nbsp;37,<br>
&nbsp;&nbsp;//&nbsp;SBE&nbsp;&nbsp;:&nbsp;36,<br>
<br>
&nbsp;&nbsp;//&nbsp;The&nbsp;SXL&nbsp;and&nbsp;UXL&nbsp;fields&nbsp;don't&nbsp;exist&nbsp;on&nbsp;RV32,&nbsp;so&nbsp;they&nbsp;are&nbsp;modelled<br>
&nbsp;&nbsp;//&nbsp;via&nbsp;explicit&nbsp;getters&nbsp;and&nbsp;setters;&nbsp;see&nbsp;below.<br>
&nbsp;&nbsp;//&nbsp;SXL&nbsp;&nbsp;:&nbsp;35&nbsp;..&nbsp;34,<br>
&nbsp;&nbsp;//&nbsp;UXL&nbsp;&nbsp;:&nbsp;33&nbsp;..&nbsp;32,<br>
<br>
&nbsp;&nbsp;TSR&nbsp;&nbsp;:&nbsp;22,<br>
&nbsp;&nbsp;TW&nbsp;&nbsp;&nbsp;:&nbsp;21,<br>
&nbsp;&nbsp;TVM&nbsp;&nbsp;:&nbsp;20,<br>
&nbsp;&nbsp;MXR&nbsp;&nbsp;:&nbsp;19,<br>
&nbsp;&nbsp;SUM&nbsp;&nbsp;:&nbsp;18,<br>
&nbsp;&nbsp;MPRV&nbsp;:&nbsp;17,<br>
<br>
&nbsp;&nbsp;XS&nbsp;&nbsp;&nbsp;:&nbsp;16&nbsp;..&nbsp;15,<br>
&nbsp;&nbsp;FS&nbsp;&nbsp;&nbsp;:&nbsp;14&nbsp;..&nbsp;13,<br>
<br>
&nbsp;&nbsp;MPP&nbsp;&nbsp;:&nbsp;12&nbsp;..&nbsp;11,<br>
&nbsp;&nbsp;VS&nbsp;&nbsp;&nbsp;:&nbsp;10&nbsp;..&nbsp;9,<br>
&nbsp;&nbsp;SPP&nbsp;&nbsp;:&nbsp;8,<br>
<br>
&nbsp;&nbsp;MPIE&nbsp;:&nbsp;7,<br>
&nbsp;&nbsp;SPIE&nbsp;:&nbsp;5,<br>
&nbsp;&nbsp;UPIE&nbsp;:&nbsp;4,<br>
<br>
&nbsp;&nbsp;MIE&nbsp;&nbsp;:&nbsp;3,<br>
&nbsp;&nbsp;SIE&nbsp;&nbsp;:&nbsp;1,<br>
&nbsp;&nbsp;UIE&nbsp;&nbsp;:&nbsp;0<br>
}<br>
register&nbsp;mstatus&nbsp;:&nbsp;Mstatus<br>
<br>
function&nbsp;get_mstatus_SXL(m&nbsp;:&nbsp;Mstatus)&nbsp;-&gt;&nbsp;arch_xlen&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;if&nbsp;&nbsp;&nbsp;sizeof(xlen)&nbsp;==&nbsp;32<br>
&nbsp;&nbsp;then&nbsp;arch_to_bits(RV32)<br>
&nbsp;&nbsp;else&nbsp;m.bits()[35&nbsp;..&nbsp;34]<br>
}</span><br>
<br>
function&nbsp;set_mstatus_SXL(m&nbsp;:&nbsp;Mstatus,&nbsp;a&nbsp;:&nbsp;arch_xlen)&nbsp;-&gt;&nbsp;Mstatus&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;if&nbsp;&nbsp;&nbsp;sizeof(xlen)&nbsp;==&nbsp;32<br>
&nbsp;&nbsp;then&nbsp;m<br>
&nbsp;&nbsp;else&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;vector_update_subrange(m.bits(),&nbsp;35,&nbsp;34,&nbsp;&nbsp;a);<br>
&nbsp;&nbsp;&nbsp;&nbsp;Mk_Mstatus(m)<br>
&nbsp;&nbsp;}<br>
}</span><br>
<br>
function&nbsp;get_mstatus_UXL(m&nbsp;:&nbsp;Mstatus)&nbsp;-&gt;&nbsp;arch_xlen&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;if&nbsp;&nbsp;&nbsp;sizeof(xlen)&nbsp;==&nbsp;32<br>
&nbsp;&nbsp;then&nbsp;arch_to_bits(RV32)<br>
&nbsp;&nbsp;else&nbsp;m.bits()[33&nbsp;..&nbsp;32]<br>
}</span><br>
<br>
function&nbsp;set_mstatus_UXL(m&nbsp;:&nbsp;Mstatus,&nbsp;a&nbsp;:&nbsp;arch_xlen)&nbsp;-&gt;&nbsp;Mstatus&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;if&nbsp;&nbsp;&nbsp;sizeof(xlen)&nbsp;==&nbsp;32<br>
&nbsp;&nbsp;then&nbsp;m<br>
&nbsp;&nbsp;else&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;vector_update_subrange(m.bits(),&nbsp;33,&nbsp;32,&nbsp;&nbsp;a);<br>
&nbsp;&nbsp;&nbsp;&nbsp;Mk_Mstatus(m)<br>
&nbsp;&nbsp;}<br>
}</span><br>
<br>
function&nbsp;get_mstatus_GVA(m&nbsp;:&nbsp;Mstatus,&nbsp;mh&nbsp;:&nbsp;Mstatush)&nbsp;-&gt;&nbsp;bits(1)&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;if&nbsp;sizeof(xlen)&nbsp;==&nbsp;32<br>
&nbsp;&nbsp;then&nbsp;mh.GVA()<br>
&nbsp;&nbsp;else&nbsp;m.bits()[38&nbsp;..&nbsp;38]<br>
}<br>
<br>
function&nbsp;set_mstatus_GVA(m&nbsp;:&nbsp;Mstatus,&nbsp;gva&nbsp;:&nbsp;bits(1))&nbsp;-&gt;&nbsp;Mstatus&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;if&nbsp;sizeof(xlen)&nbsp;==&nbsp;32<br>
&nbsp;&nbsp;then&nbsp;m<br>
&nbsp;&nbsp;else&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;vector_update_subrange(m.bits(),&nbsp;38,&nbsp;38,&nbsp;gva);<br>
&nbsp;&nbsp;&nbsp;&nbsp;Mk_Mstatus(m)<br>
&nbsp;&nbsp;}<br>
}</span><br>
<br>
function&nbsp;set_mstatush_GVA(mh&nbsp;:&nbsp;Mstatush,&nbsp;gva&nbsp;:&nbsp;bits(1))&nbsp;-&gt;&nbsp;Mstatush&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">{<br>
&nbsp;&nbsp;if&nbsp;sizeof(xlen)&nbsp;==&nbsp;32<br>
&nbsp;&nbsp;then&nbsp;update_GVA(mh,&nbsp;gva)<br>
&nbsp;&nbsp;else&nbsp;mh<br>
}</span><br>
<br>
function&nbsp;get_mstatus_MPV(m&nbsp;:&nbsp;Mstatus,&nbsp;mh:&nbsp;Mstatush)&nbsp;-&gt;&nbsp;virt_mode&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;if&nbsp;sizeof(xlen)&nbsp;==&nbsp;32<br>
&nbsp;&nbsp;then&nbsp;mh.MPV()<br>
&nbsp;&nbsp;else&nbsp;m.bits()[39&nbsp;..&nbsp;39]<br>
}</span><br>
<br>
function&nbsp;set_mstatus_MPV(m&nbsp;:&nbsp;Mstatus,&nbsp;v&nbsp;:&nbsp;virt_mode)&nbsp;-&gt;&nbsp;Mstatus&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;if&nbsp;sizeof(xlen)&nbsp;==&nbsp;32<br>
&nbsp;&nbsp;then&nbsp;m<br>
&nbsp;&nbsp;else&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;vector_update_subrange(m.bits(),&nbsp;39,&nbsp;39,&nbsp;v);<br>
&nbsp;&nbsp;&nbsp;&nbsp;Mk_Mstatus(m)<br>
&nbsp;&nbsp;}<br>
}</span><br>
<br>
function&nbsp;set_mstatush_MPV(mh&nbsp;:&nbsp;Mstatush,&nbsp;v&nbsp;:&nbsp;virt_mode)&nbsp;-&gt;&nbsp;Mstatush&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;if&nbsp;sizeof(xlen)&nbsp;==&nbsp;32<br>
&nbsp;&nbsp;then&nbsp;update_MPV(mh,&nbsp;v)<br>
&nbsp;&nbsp;else&nbsp;mh<br>
}<br>
<br>
function&nbsp;effectivePrivilege(t&nbsp;:&nbsp;AccessType(ext_access_type),&nbsp;m&nbsp;:&nbsp;Mstatus,&nbsp;priv&nbsp;:&nbsp;Privilege)&nbsp;-&gt;&nbsp;Privilege&nbsp;=<br>
&nbsp;&nbsp;<span style="background-color: hsl(120, 85%, 80%)">if&nbsp;&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">t&nbsp;!=&nbsp;Execute()&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 75%)">m.MPRV()&nbsp;==&nbsp;0b1</span></span><br>
&nbsp;&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 80%)">privLevel_of_bits(m.MPP())</span><br>
&nbsp;&nbsp;else&nbsp;<span style="background-color: hsl(120, 85%, 75%)">priv</span></span><br>
<br>
function&nbsp;effectiveVirtualization(t&nbsp;:&nbsp;AccessType(ext_access_type),&nbsp;m&nbsp;:&nbsp;Mstatus,&nbsp;mh:&nbsp;Mstatush,&nbsp;virt&nbsp;:&nbsp;Virtualization)&nbsp;-&gt;&nbsp;Virtualization&nbsp;=<br>
&nbsp;&nbsp;<span style="background-color: hsl(120, 85%, 80%)">if&nbsp;&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">t&nbsp;!=&nbsp;Execute()&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 75%)">m.MPRV()&nbsp;==&nbsp;0b1</span></span><br>
&nbsp;&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 80%)">virtMode_of_bits(get_mstatus_MPV(m,&nbsp;mh))</span><br>
&nbsp;&nbsp;else&nbsp;<span style="background-color: hsl(120, 85%, 75%)">virt</span></span><br>
<br>
function&nbsp;legalize_mstatus(o&nbsp;:&nbsp;Mstatus,&nbsp;v&nbsp;:&nbsp;xlenbits)&nbsp;-&gt;&nbsp;Mstatus&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;/*<br>
&nbsp;&nbsp;&nbsp;*&nbsp;Populate&nbsp;all&nbsp;defined&nbsp;fields&nbsp;using&nbsp;the&nbsp;bits&nbsp;of&nbsp;v,&nbsp;stripping&nbsp;anything<br>
&nbsp;&nbsp;&nbsp;*&nbsp;that&nbsp;does&nbsp;not&nbsp;have&nbsp;a&nbsp;matching&nbsp;bitfield&nbsp;entry.&nbsp;All&nbsp;bits&nbsp;above&nbsp;32&nbsp;are&nbsp;handled<br>
&nbsp;&nbsp;&nbsp;*&nbsp;explicitly&nbsp;later.<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;:&nbsp;Mstatus&nbsp;=&nbsp;Mk_Mstatus(zero_extend(v[22&nbsp;..&nbsp;7]&nbsp;@&nbsp;0b0&nbsp;@&nbsp;v[5&nbsp;..&nbsp;3]&nbsp;@&nbsp;0b0&nbsp;@&nbsp;v[1&nbsp;..&nbsp;0]));<br>
<br>
&nbsp;&nbsp;/*&nbsp;We&nbsp;don't&nbsp;have&nbsp;any&nbsp;extension&nbsp;context&nbsp;yet.&nbsp;*/<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_XS(m,&nbsp;extStatus_to_bits(Off));<br>
<br>
&nbsp;&nbsp;/*&nbsp;FS&nbsp;is&nbsp;WARL,&nbsp;and&nbsp;making&nbsp;FS&nbsp;writable&nbsp;can&nbsp;support&nbsp;the&nbsp;M-mode&nbsp;emulation&nbsp;of&nbsp;an&nbsp;FPU<br>
&nbsp;&nbsp;&nbsp;*&nbsp;to&nbsp;support&nbsp;code&nbsp;running&nbsp;in&nbsp;S/U-modes.&nbsp;&nbsp;Spike&nbsp;does&nbsp;this,&nbsp;and&nbsp;for&nbsp;now,&nbsp;we&nbsp;match&nbsp;it,<br>
&nbsp;&nbsp;&nbsp;*&nbsp;but&nbsp;only&nbsp;if&nbsp;Zfinx&nbsp;isn't&nbsp;enabled.<br>
&nbsp;&nbsp;&nbsp;*&nbsp;FIXME:&nbsp;This&nbsp;should&nbsp;be&nbsp;made&nbsp;a&nbsp;platform&nbsp;parameter.<br>
&nbsp;&nbsp;&nbsp;*/<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;sys_enable_zfinx()&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 75%)">update_FS(m,&nbsp;extStatus_to_bits(Off))</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;let&nbsp;dirty&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">extStatus_of_bits(m.FS())&nbsp;==&nbsp;Dirty&nbsp;|&nbsp;<span style="background-color: hsl(120, 85%, 75%)">extStatus_of_bits(m.XS())&nbsp;==&nbsp;Dirty&nbsp;|<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: hsl(120, 85%, 70%)">extStatus_of_bits(m.VS())&nbsp;==&nbsp;Dirty</span></span></span>;<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_SD(m,&nbsp;bool_to_bits(dirty));<br>
<br>
&nbsp;&nbsp;/*&nbsp;We&nbsp;don't&nbsp;support&nbsp;dynamic&nbsp;changes&nbsp;to&nbsp;SXL&nbsp;and&nbsp;UXL.&nbsp;*/<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;set_mstatus_SXL(m,&nbsp;get_mstatus_SXL(o));<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;set_mstatus_UXL(m,&nbsp;get_mstatus_UXL(o));<br>
<br>
&nbsp;&nbsp;/*&nbsp;We&nbsp;don't&nbsp;currently&nbsp;support&nbsp;changing&nbsp;MBE&nbsp;and&nbsp;SBE.&nbsp;*/<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;if&nbsp;sizeof(xlen)&nbsp;==&nbsp;64&nbsp;then&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mk_Mstatus([m.bits()&nbsp;with&nbsp;37&nbsp;..&nbsp;36&nbsp;=&nbsp;0b00])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;m;<br>
<br>
&nbsp;&nbsp;/*&nbsp;Update&nbsp;GVA&nbsp;&&nbsp;MPV&nbsp;*/<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;if&nbsp;sizeof(xlen)&nbsp;==&nbsp;32&nbsp;then&nbsp;m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;Mk_Mstatus([m.bits()&nbsp;with&nbsp;39&nbsp;..&nbsp;38&nbsp;=&nbsp;v[39&nbsp;..&nbsp;38]]);<br>
<br>
&nbsp;&nbsp;/*&nbsp;Hardwired&nbsp;to&nbsp;zero&nbsp;in&nbsp;the&nbsp;absence&nbsp;of&nbsp;'U'&nbsp;or&nbsp;'N'.&nbsp;*/<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;not(haveNExt())&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_UPIE(m,&nbsp;0b0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_UIE(m,&nbsp;0b0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span>&nbsp;else&nbsp;m</span>;<br>
<br>
&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;not(haveUsrMode())&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 75%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_MPRV(m,&nbsp;0b0);<br>
&nbsp;&nbsp;&nbsp;&nbsp;m<br>
&nbsp;&nbsp;}</span>&nbsp;else&nbsp;m</span><br>
}</span><br>
<br>
/*&nbsp;architecture&nbsp;and&nbsp;extension&nbsp;checks&nbsp;*/<br>
<br>
function&nbsp;cur_Architecture()&nbsp;-&gt;&nbsp;Architecture&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;a&nbsp;:&nbsp;arch_xlen&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">match&nbsp;(cur_privilege)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Machine&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">misa.MXL()</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Supervisor&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 75%)">get_mstatus_SXL(mstatus)</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 75%)">get_mstatus_UXL(mstatus)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span>;<br>
&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">match&nbsp;architecture(a)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;Some(a)&nbsp;=&gt;&nbsp;a,<br>
&nbsp;&nbsp;&nbsp;&nbsp;None()&nbsp;&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 75%)">internal_error(__FILE__,&nbsp;__LINE__,&nbsp;&quot;Invalid&nbsp;current&nbsp;architecture&quot;)</span><br>
&nbsp;&nbsp;}</span><br>
}</span><br>
<br>
function&nbsp;in32BitMode()&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">{<br>
&nbsp;&nbsp;cur_Architecture()&nbsp;==&nbsp;RV32<br>
}</span><br>
<br>
/*&nbsp;F&nbsp;and&nbsp;D&nbsp;extensions&nbsp;have&nbsp;to&nbsp;enabled&nbsp;both&nbsp;via&nbsp;misa.{FD}&nbsp;as&nbsp;well&nbsp;as&nbsp;mstatus.FS&nbsp;*/<br>
function&nbsp;haveFExt()&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">(misa.F()&nbsp;==&nbsp;0b1)&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 75%)">mstatus.FS()&nbsp;!=&nbsp;0b00</span>)</span><br>
function&nbsp;haveDExt()&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">(misa.D()&nbsp;==&nbsp;0b1)&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 75%)">mstatus.FS()&nbsp;!=&nbsp;0b00</span>)</span><br>
/*&nbsp;Zfh&nbsp;(half-precision)&nbsp;extension&nbsp;depends&nbsp;on&nbsp;misa.F&nbsp;and&nbsp;mstatus.FS&nbsp;*/<br>
function&nbsp;haveZfh()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">(misa.F()&nbsp;==&nbsp;0b1)&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 75%)">mstatus.FS()&nbsp;!=&nbsp;0b00</span>)</span><br>
/*&nbsp;V&nbsp;extension&nbsp;has&nbsp;to&nbsp;enable&nbsp;both&nbsp;via&nbsp;misa.V&nbsp;as&nbsp;well&nbsp;as&nbsp;mstatus.VS&nbsp;*/<br>
function&nbsp;haveVExt()&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">(misa.V()&nbsp;==&nbsp;0b1)&nbsp;&&nbsp;(<span style="background-color: hsl(0, 85%, 75%)">mstatus.VS()&nbsp;!=&nbsp;0b00</span>)</span><br>
<br>
/*&nbsp;Zhinx,&nbsp;Zfinx&nbsp;and&nbsp;Zdinx&nbsp;extensions&nbsp;(TODO:&nbsp;gate&nbsp;FCSR&nbsp;access&nbsp;on&nbsp;[mhs]stateen0&nbsp;bit&nbsp;1&nbsp;when&nbsp;implemented)&nbsp;*/<br>
function&nbsp;haveZhinx()&nbsp;&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">sys_enable_zfinx()</span><br>
function&nbsp;haveZfinx()&nbsp;&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">sys_enable_zfinx()</span><br>
function&nbsp;haveZdinx()&nbsp;&nbsp;&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">sys_enable_zfinx()&nbsp;&&nbsp;sizeof(flen)&nbsp;&gt;=&nbsp;64</span><br>
<br>
/*&nbsp;interrupt&nbsp;processing&nbsp;state&nbsp;*/<br>
<br>
bitfield&nbsp;Minterrupts&nbsp;:&nbsp;xlenbits&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;SGEI&nbsp;:&nbsp;12,&nbsp;/*&nbsp;external&nbsp;interrupts&nbsp;*/<br>
&nbsp;&nbsp;MEI&nbsp;&nbsp;:&nbsp;11,<br>
&nbsp;&nbsp;VSEI&nbsp;:&nbsp;10,<br>
&nbsp;&nbsp;SEI&nbsp;&nbsp;:&nbsp;9,<br>
&nbsp;&nbsp;UEI&nbsp;&nbsp;:&nbsp;8,<br>
<br>
&nbsp;&nbsp;MTI&nbsp;&nbsp;:&nbsp;7,&nbsp;&nbsp;/*&nbsp;timers&nbsp;interrupts&nbsp;*/<br>
&nbsp;&nbsp;VSTI&nbsp;:&nbsp;6,<br>
&nbsp;&nbsp;STI&nbsp;&nbsp;:&nbsp;5,<br>
&nbsp;&nbsp;UTI&nbsp;&nbsp;:&nbsp;4,<br>
<br>
&nbsp;&nbsp;MSI&nbsp;&nbsp;:&nbsp;3,&nbsp;&nbsp;/*&nbsp;software&nbsp;interrupts&nbsp;*/<br>
&nbsp;&nbsp;VSSI&nbsp;:&nbsp;2,<br>
&nbsp;&nbsp;SSI&nbsp;&nbsp;:&nbsp;1,<br>
&nbsp;&nbsp;USI&nbsp;&nbsp;:&nbsp;0,<br>
}<br>
register&nbsp;mip&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;Minterrupts&nbsp;/*&nbsp;Pending&nbsp;*/<br>
register&nbsp;mie&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;Minterrupts&nbsp;/*&nbsp;Enabled&nbsp;*/<br>
register&nbsp;mideleg&nbsp;:&nbsp;Minterrupts&nbsp;/*&nbsp;Delegation&nbsp;to&nbsp;S-mode&nbsp;*/<br>
<br>
//&nbsp;Legalize&nbsp;mip&nbsp;from&nbsp;the&nbsp;previous&nbsp;mip&nbsp;(m)&nbsp;and&nbsp;the&nbsp;written&nbsp;mip&nbsp;(m)<br>
function&nbsp;legalize_mip(o&nbsp;:&nbsp;Minterrupts,&nbsp;v&nbsp;:&nbsp;xlenbits)&nbsp;-&gt;&nbsp;Minterrupts&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;v&nbsp;=&nbsp;Mk_Minterrupts(v);<br>
&nbsp;&nbsp;/*&nbsp;S-mode&nbsp;bits&nbsp;are&nbsp;writable&nbsp;*/<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_SEI(o,&nbsp;v.SEI());<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_STI(m,&nbsp;v.STI());<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_SSI(m,&nbsp;v.SSI());<br>
&nbsp;&nbsp;/*&nbsp;When&nbsp;the&nbsp;'N'&nbsp;extension&nbsp;is&nbsp;present,&nbsp;U-mode&nbsp;bits&nbsp;are&nbsp;writable&nbsp;as&nbsp;well&nbsp;*/<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;<span style="background-color: hsl(0, 85%, 75%)">haveUsrMode()&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 75%)">haveNExt()</span></span>&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 75%)">update_UEI(m,&nbsp;v.UEI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;<span style="background-color: hsl(0, 85%, 75%)">haveUsrMode()&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 75%)">haveNExt()</span></span>&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 75%)">update_UTI(m,&nbsp;v.UTI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;<span style="background-color: hsl(0, 85%, 75%)">haveUsrMode()&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 75%)">haveNExt()</span></span>&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 75%)">update_USI(m,&nbsp;v.USI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;/*&nbsp;As&nbsp;SGEI,&nbsp;VSEI,&nbsp;VSTI&nbsp;&&nbsp;VSSI&nbsp;in&nbsp;mip&nbsp;are&nbsp;aliases&nbsp;for&nbsp;their&nbsp;corresponding&nbsp;bits<br>
&nbsp;&nbsp;in&nbsp;hip,&nbsp;only&nbsp;mip.VSSI&nbsp;is&nbsp;writable&nbsp;*/<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;haveHExt()&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">update_VSSI(m,&nbsp;v.VSSI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;m<br>
}</span><br>
<br>
function&nbsp;legalize_mie(o&nbsp;:&nbsp;Minterrupts,&nbsp;v&nbsp;:&nbsp;xlenbits)&nbsp;-&gt;&nbsp;Minterrupts&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;v&nbsp;=&nbsp;Mk_Minterrupts(v);<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_MEI(o,&nbsp;v.MEI());<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_MTI(m,&nbsp;v.MTI());<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_MSI(m,&nbsp;v.MSI());<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_SEI(m,&nbsp;v.SEI());<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_STI(m,&nbsp;v.STI());<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_SSI(m,&nbsp;v.SSI());<br>
&nbsp;&nbsp;/*&nbsp;These&nbsp;interrupts&nbsp;can&nbsp;only&nbsp;be&nbsp;enabled&nbsp;when&nbsp;the&nbsp;hypervisor&nbsp;extention&nbsp;is&nbsp;present&nbsp;*/<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;haveHExt()&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">update_SGEI(m,&nbsp;v.SGEI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;haveHExt()&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">update_VSEI(m,&nbsp;v.VSEI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;haveHExt()&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">update_VSTI(m,&nbsp;v.VSTI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;haveHExt()&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">update_VSSI(m,&nbsp;v.VSSI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;/*&nbsp;The&nbsp;U-mode&nbsp;bits&nbsp;will&nbsp;be&nbsp;modified&nbsp;if&nbsp;we&nbsp;have&nbsp;the&nbsp;'N'&nbsp;extension.&nbsp;*/<br>
&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;<span style="background-color: hsl(0, 85%, 75%)">haveUsrMode()&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 75%)">haveNExt()</span></span>&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 75%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_UEI(m,&nbsp;v.UEI());<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_UTI(m,&nbsp;v.UTI());<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_USI(m,&nbsp;v.USI());<br>
&nbsp;&nbsp;&nbsp;&nbsp;m<br>
&nbsp;&nbsp;}</span>&nbsp;else&nbsp;m</span><br>
}</span><br>
<br>
function&nbsp;legalize_mideleg(o&nbsp;:&nbsp;Minterrupts,&nbsp;v&nbsp;:&nbsp;xlenbits)&nbsp;-&gt;&nbsp;Minterrupts&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;/*&nbsp;M-mode&nbsp;interrupt&nbsp;delegation&nbsp;bits&nbsp;&quot;should&quot;&nbsp;be&nbsp;hardwired&nbsp;to&nbsp;0.&nbsp;*/<br>
&nbsp;&nbsp;/*&nbsp;FIXME:&nbsp;needs&nbsp;verification&nbsp;against&nbsp;eventual&nbsp;spec&nbsp;language.&nbsp;*/<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;Mk_Minterrupts(v);<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_MEI(m,&nbsp;0b0);<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_MTI(m,&nbsp;0b0);<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_MSI(m,&nbsp;0b0);<br>
&nbsp;&nbsp;/*&nbsp;VS-mode&nbsp;interrupts&nbsp;are&nbsp;always&nbsp;delegated&nbsp;when&nbsp;the&nbsp;H-extesion&nbsp;is&nbsp;present&nbsp;*/<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;haveHExt()&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">update_VSEI(m,&nbsp;0b1)</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;haveHExt()&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">update_VSTI(m,&nbsp;0b1)</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;haveHExt()&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">update_VSSI(m,&nbsp;0b1)</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;/*&nbsp;If&nbsp;GEILEN&nbsp;&gt;&nbsp;0,&nbsp;SGEI&nbsp;is&nbsp;always&nbsp;delegated&nbsp;*/<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;haveHExt()&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">update_SGEI(m,&nbsp;0b1)</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;m<br>
}</span><br>
<br>
/*&nbsp;exception&nbsp;processing&nbsp;state&nbsp;*/<br>
<br>
bitfield&nbsp;Medeleg&nbsp;:&nbsp;xlenbits&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;SAMO_GPage_Fault&nbsp;&nbsp;:&nbsp;23,<br>
&nbsp;&nbsp;Virtual_Instr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;22,<br>
&nbsp;&nbsp;Load_GPage_Fault&nbsp;&nbsp;:&nbsp;21,<br>
&nbsp;&nbsp;Fetch_GPage_Fault&nbsp;:&nbsp;20,<br>
&nbsp;&nbsp;SAMO_Page_Fault&nbsp;&nbsp;&nbsp;:&nbsp;15,<br>
&nbsp;&nbsp;Load_Page_Fault&nbsp;&nbsp;&nbsp;:&nbsp;13,<br>
&nbsp;&nbsp;Fetch_Page_Fault&nbsp;&nbsp;:&nbsp;12,<br>
&nbsp;&nbsp;MEnvCall&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;11,<br>
&nbsp;&nbsp;VSEnvCall&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;10,<br>
&nbsp;&nbsp;HSEnvCall&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;9,<br>
&nbsp;&nbsp;UEnvCall&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;8,<br>
&nbsp;&nbsp;SAMO_Access_Fault&nbsp;:&nbsp;7,<br>
&nbsp;&nbsp;SAMO_Addr_Align&nbsp;&nbsp;&nbsp;:&nbsp;6,<br>
&nbsp;&nbsp;Load_Access_Fault&nbsp;:&nbsp;5,<br>
&nbsp;&nbsp;Load_Addr_Align&nbsp;&nbsp;&nbsp;:&nbsp;4,<br>
&nbsp;&nbsp;Breakpoint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;3,<br>
&nbsp;&nbsp;Illegal_Instr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;2,<br>
&nbsp;&nbsp;Fetch_Access_Fault:&nbsp;1,<br>
&nbsp;&nbsp;Fetch_Addr_Align&nbsp;&nbsp;:&nbsp;0<br>
}<br>
register&nbsp;medeleg&nbsp;:&nbsp;Medeleg&nbsp;&nbsp;/*&nbsp;Delegation&nbsp;to&nbsp;S-mode&nbsp;*/<br>
<br>
function&nbsp;legalize_medeleg(o&nbsp;:&nbsp;Medeleg,&nbsp;v&nbsp;:&nbsp;xlenbits)&nbsp;-&gt;&nbsp;Medeleg&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;Mk_Medeleg(v);<br>
&nbsp;&nbsp;/*&nbsp;M-EnvCalls&nbsp;delegation&nbsp;is&nbsp;not&nbsp;supported&nbsp;*/<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_MEnvCall(m,&nbsp;0b0);<br>
&nbsp;&nbsp;m<br>
}</span><br>
<br>
/*&nbsp;registers&nbsp;for&nbsp;trap&nbsp;handling&nbsp;*/<br>
<br>
bitfield&nbsp;Mtvec&nbsp;:&nbsp;xlenbits&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;Base&nbsp;:&nbsp;xlen&nbsp;-&nbsp;1&nbsp;..&nbsp;2,<br>
&nbsp;&nbsp;Mode&nbsp;:&nbsp;1&nbsp;..&nbsp;0<br>
}<br>
register&nbsp;mtvec&nbsp;:&nbsp;Mtvec&nbsp;&nbsp;/*&nbsp;Trap&nbsp;Vector&nbsp;*/<br>
<br>
function&nbsp;legalize_tvec(o&nbsp;:&nbsp;Mtvec,&nbsp;v&nbsp;:&nbsp;xlenbits)&nbsp;-&gt;&nbsp;Mtvec&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;let&nbsp;v&nbsp;=&nbsp;Mk_Mtvec(v);<br>
&nbsp;<span style="background-color: hsl(0, 85%, 80%)">match&nbsp;(trapVectorMode_of_bits(v.Mode()))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;TV_Direct&nbsp;=&gt;&nbsp;v,<br>
&nbsp;&nbsp;&nbsp;TV_Vector&nbsp;=&gt;&nbsp;v,<br>
&nbsp;&nbsp;&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">update_Mode(v,&nbsp;o.Mode())</span><br>
&nbsp;}</span><br>
}</span><br>
<br>
bitfield&nbsp;Mcause&nbsp;:&nbsp;xlenbits&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;IsInterrupt&nbsp;:&nbsp;xlen&nbsp;-&nbsp;1,<br>
&nbsp;&nbsp;Cause&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;xlen&nbsp;-&nbsp;2&nbsp;..&nbsp;0<br>
}<br>
register&nbsp;mcause&nbsp;:&nbsp;Mcause<br>
<br>
/*&nbsp;Interpreting&nbsp;the&nbsp;trap-vector&nbsp;address&nbsp;*/<br>
function&nbsp;tvec_addr(m&nbsp;:&nbsp;Mtvec,&nbsp;c&nbsp;:&nbsp;Mcause)&nbsp;-&gt;&nbsp;option(xlenbits)&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;base&nbsp;:&nbsp;xlenbits&nbsp;=&nbsp;m.Base()&nbsp;@&nbsp;0b00;<br>
&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">match&nbsp;(trapVectorMode_of_bits(m.Mode()))&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;TV_Direct&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">Some(base)</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;TV_Vector&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 75%)">if&nbsp;&nbsp;&nbsp;c.IsInterrupt()&nbsp;==&nbsp;0b1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 70%)">Some(base&nbsp;+&nbsp;(zero_extend(c.Cause())&nbsp;&lt;&lt;&nbsp;2))</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;<span style="background-color: hsl(0, 85%, 70%)">Some(base)</span></span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;TV_Reserved&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 75%)">None()</span><br>
&nbsp;&nbsp;}</span><br>
}</span><br>
<br>
/*&nbsp;Exception&nbsp;PC&nbsp;*/<br>
<br>
register&nbsp;mepc&nbsp;:&nbsp;xlenbits<br>
<br>
/*&nbsp;The&nbsp;xepc&nbsp;legalization&nbsp;zeroes&nbsp;xepc[1:0]&nbsp;when&nbsp;misa.C&nbsp;is&nbsp;hardwired&nbsp;to&nbsp;0.<br>
&nbsp;*&nbsp;When&nbsp;misa.C&nbsp;is&nbsp;writable,&nbsp;it&nbsp;zeroes&nbsp;only&nbsp;xepc[0].<br>
&nbsp;*/<br>
function&nbsp;legalize_xepc(v&nbsp;:&nbsp;xlenbits)&nbsp;-&gt;&nbsp;xlenbits&nbsp;=<br>
&nbsp;&nbsp;/*&nbsp;allow&nbsp;writing&nbsp;xepc[1]&nbsp;only&nbsp;if&nbsp;misa.C&nbsp;is&nbsp;enabled&nbsp;or&nbsp;could&nbsp;be&nbsp;enabled<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XXX&nbsp;specification&nbsp;says&nbsp;this&nbsp;legalization&nbsp;should&nbsp;be&nbsp;done&nbsp;on&nbsp;read&nbsp;*/<br>
&nbsp;&nbsp;<span style="background-color: hsl(120, 85%, 80%)">if&nbsp;&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">(<span style="background-color: hsl(0, 85%, 75%)">sys_enable_writable_misa()&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 75%)">sys_enable_rvc()</span></span>)&nbsp;|&nbsp;<span style="background-color: hsl(0, 85%, 75%)">misa.C()&nbsp;==&nbsp;0b1</span></span><br>
&nbsp;&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">[v&nbsp;with&nbsp;0&nbsp;=&nbsp;bitzero]</span><br>
&nbsp;&nbsp;else&nbsp;<span style="background-color: hsl(0, 85%, 80%)">v&nbsp;&&nbsp;sign_extend(0b100)</span></span><br>
<br>
/*&nbsp;masking&nbsp;for&nbsp;reads&nbsp;to&nbsp;xepc&nbsp;*/<br>
function&nbsp;pc_alignment_mask()&nbsp;-&gt;&nbsp;xlenbits&nbsp;=<br>
&nbsp;&nbsp;<span style="background-color: hsl(120, 85%, 80%)">~(zero_extend(<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;misa.C()&nbsp;==&nbsp;0b1&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">0b00</span>&nbsp;else&nbsp;<span style="background-color: hsl(0, 85%, 75%)">0b10</span></span>))</span><br>
<br>
/*&nbsp;auxiliary&nbsp;exception&nbsp;registers&nbsp;*/<br>
<br>
register&nbsp;mtval&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;xlenbits<br>
register&nbsp;mscratch&nbsp;:&nbsp;xlenbits<br>
/*&nbsp;counters&nbsp;*/<br>
<br>
bitfield&nbsp;Counteren&nbsp;:&nbsp;bits(32)&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;HPM&nbsp;&nbsp;:&nbsp;31&nbsp;..&nbsp;3,<br>
&nbsp;&nbsp;IR&nbsp;&nbsp;&nbsp;:&nbsp;2,<br>
&nbsp;&nbsp;TM&nbsp;&nbsp;&nbsp;:&nbsp;1,<br>
&nbsp;&nbsp;CY&nbsp;&nbsp;&nbsp;:&nbsp;0<br>
}<br>
<br>
register&nbsp;mcounteren&nbsp;:&nbsp;Counteren<br>
register&nbsp;scounteren&nbsp;:&nbsp;Counteren<br>
<br>
function&nbsp;legalize_counteren(c&nbsp;:&nbsp;Counteren,&nbsp;v&nbsp;:&nbsp;xlenbits)&nbsp;-&gt;&nbsp;Counteren&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;/*&nbsp;no&nbsp;HPM&nbsp;counters&nbsp;yet&nbsp;*/<br>
&nbsp;&nbsp;let&nbsp;c&nbsp;=&nbsp;update_IR(c,&nbsp;[v[2]]);<br>
&nbsp;&nbsp;let&nbsp;c&nbsp;=&nbsp;update_TM(c,&nbsp;[v[1]]);<br>
&nbsp;&nbsp;let&nbsp;c&nbsp;=&nbsp;update_CY(c,&nbsp;[v[0]]);<br>
&nbsp;&nbsp;c<br>
}</span><br>
<br>
function&nbsp;legalize_mcounteren(c&nbsp;:&nbsp;Counteren,&nbsp;v&nbsp;:&nbsp;xlenbits)&nbsp;-&gt;&nbsp;Counteren&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;legalize_counteren(c,&nbsp;v)<br>
}</span><br>
<br>
function&nbsp;legalize_scounteren(c&nbsp;:&nbsp;Counteren,&nbsp;v&nbsp;:&nbsp;xlenbits)&nbsp;-&gt;&nbsp;Counteren&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;legalize_counteren(c,&nbsp;v)<br>
}</span><br>
<br>
bitfield&nbsp;Counterin&nbsp;:&nbsp;bits(32)&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;/*&nbsp;no&nbsp;HPM&nbsp;counters&nbsp;yet&nbsp;*/<br>
&nbsp;&nbsp;IR&nbsp;:&nbsp;2,<br>
&nbsp;&nbsp;CY&nbsp;:&nbsp;0<br>
}<br>
register&nbsp;mcountinhibit&nbsp;:&nbsp;Counterin<br>
<br>
function&nbsp;legalize_mcountinhibit(c&nbsp;:&nbsp;Counterin,&nbsp;v&nbsp;:&nbsp;xlenbits)&nbsp;-&gt;&nbsp;Counterin&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;c&nbsp;=&nbsp;update_IR(c,&nbsp;[v[2]]);<br>
&nbsp;&nbsp;let&nbsp;c&nbsp;=&nbsp;update_CY(c,&nbsp;[v[0]]);<br>
&nbsp;&nbsp;c<br>
}</span><br>
<br>
register&nbsp;mcycle&nbsp;:&nbsp;bits(64)<br>
register&nbsp;mtime&nbsp;:&nbsp;bits(64)<br>
<br>
/*&nbsp;minstret<br>
&nbsp;*<br>
&nbsp;*&nbsp;minstret&nbsp;is&nbsp;an&nbsp;architectural&nbsp;register,&nbsp;and&nbsp;can&nbsp;be&nbsp;written&nbsp;to.&nbsp;&nbsp;The<br>
&nbsp;*&nbsp;spec&nbsp;says&nbsp;that&nbsp;minstret&nbsp;increments&nbsp;on&nbsp;instruction&nbsp;retires&nbsp;need&nbsp;to<br>
&nbsp;*&nbsp;occur&nbsp;before&nbsp;any&nbsp;explicit&nbsp;writes&nbsp;to&nbsp;instret.&nbsp;&nbsp;However,&nbsp;in&nbsp;our<br>
&nbsp;*&nbsp;simulation&nbsp;loop,&nbsp;we&nbsp;need&nbsp;to&nbsp;execute&nbsp;an&nbsp;instruction&nbsp;to&nbsp;find&nbsp;out<br>
&nbsp;*&nbsp;whether&nbsp;it&nbsp;retired,&nbsp;and&nbsp;hence&nbsp;can&nbsp;only&nbsp;increment&nbsp;instret&nbsp;after<br>
&nbsp;*&nbsp;execution.&nbsp;&nbsp;To&nbsp;avoid&nbsp;doing&nbsp;this&nbsp;in&nbsp;the&nbsp;case&nbsp;minstret&nbsp;was&nbsp;explicitly<br>
&nbsp;*&nbsp;written&nbsp;to,&nbsp;we&nbsp;track&nbsp;whether&nbsp;it&nbsp;should&nbsp;increment&nbsp;in&nbsp;a&nbsp;separate<br>
&nbsp;*&nbsp;model-internal&nbsp;register.<br>
&nbsp;*/<br>
register&nbsp;minstret&nbsp;:&nbsp;bits(64)<br>
<br>
/*&nbsp;Should&nbsp;minstret&nbsp;be&nbsp;incremented&nbsp;when&nbsp;the&nbsp;instruction&nbsp;is&nbsp;retired.&nbsp;*/<br>
register&nbsp;minstret_increment&nbsp;:&nbsp;bool<br>
<br>
function&nbsp;retire_instruction()&nbsp;-&gt;&nbsp;unit&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;minstret_increment&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">minstret&nbsp;=&nbsp;minstret&nbsp;+&nbsp;1</span></span><span style="background-color: hsl(0, 85%, 80%)">&#171;Invisible branch not taken here&#187</span>;<br>
}</span><br>
<br>
/*&nbsp;informational&nbsp;registers&nbsp;*/<br>
register&nbsp;mvendorid&nbsp;:&nbsp;bits(32)<br>
register&nbsp;mimpid&nbsp;:&nbsp;xlenbits<br>
register&nbsp;marchid&nbsp;:&nbsp;xlenbits<br>
/*&nbsp;TODO:&nbsp;this&nbsp;should&nbsp;be&nbsp;readonly,&nbsp;and&nbsp;always&nbsp;0&nbsp;for&nbsp;now&nbsp;*/<br>
register&nbsp;mhartid&nbsp;:&nbsp;xlenbits<br>
<br>
/*&nbsp;S-mode&nbsp;registers&nbsp;*/<br>
<br>
/*&nbsp;sstatus&nbsp;reveals&nbsp;a&nbsp;subset&nbsp;of&nbsp;mstatus&nbsp;*/<br>
bitfield&nbsp;Sstatus&nbsp;:&nbsp;xlenbits&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;SD&nbsp;&nbsp;&nbsp;:&nbsp;xlen&nbsp;-&nbsp;1,<br>
&nbsp;&nbsp;//&nbsp;The&nbsp;UXL&nbsp;field&nbsp;does&nbsp;not&nbsp;exist&nbsp;on&nbsp;RV32,&nbsp;so&nbsp;we&nbsp;define&nbsp;an&nbsp;explicit<br>
&nbsp;&nbsp;//&nbsp;getter&nbsp;and&nbsp;setter&nbsp;below.<br>
&nbsp;&nbsp;//&nbsp;UXL&nbsp;&nbsp;:&nbsp;30&nbsp;..&nbsp;29,<br>
&nbsp;&nbsp;MXR&nbsp;&nbsp;:&nbsp;19,<br>
&nbsp;&nbsp;SUM&nbsp;&nbsp;:&nbsp;18,<br>
&nbsp;&nbsp;XS&nbsp;&nbsp;&nbsp;:&nbsp;16&nbsp;..&nbsp;15,<br>
&nbsp;&nbsp;FS&nbsp;&nbsp;&nbsp;:&nbsp;14&nbsp;..&nbsp;13,<br>
&nbsp;&nbsp;VS&nbsp;&nbsp;&nbsp;:&nbsp;10&nbsp;..&nbsp;9,<br>
&nbsp;&nbsp;SPP&nbsp;&nbsp;:&nbsp;8,<br>
&nbsp;&nbsp;SPIE&nbsp;:&nbsp;5,<br>
&nbsp;&nbsp;UPIE&nbsp;:&nbsp;4,<br>
&nbsp;&nbsp;SIE&nbsp;&nbsp;:&nbsp;1,<br>
&nbsp;&nbsp;UIE&nbsp;&nbsp;:&nbsp;0<br>
}<br>
/*&nbsp;sstatus&nbsp;is&nbsp;a&nbsp;view&nbsp;of&nbsp;mstatus,&nbsp;so&nbsp;there&nbsp;is&nbsp;no&nbsp;register&nbsp;defined.&nbsp;*/<br>
<br>
function&nbsp;get_sstatus_UXL(s&nbsp;:&nbsp;Sstatus)&nbsp;-&gt;&nbsp;arch_xlen&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;Mk_Mstatus(s.bits());<br>
&nbsp;&nbsp;get_mstatus_UXL(m)<br>
}<br>
<br>
function&nbsp;set_sstatus_UXL(s&nbsp;:&nbsp;Sstatus,&nbsp;a&nbsp;:&nbsp;arch_xlen)&nbsp;-&gt;&nbsp;Sstatus&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;Mk_Mstatus(s.bits());<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;set_mstatus_UXL(m,&nbsp;a);<br>
&nbsp;&nbsp;Mk_Sstatus(m.bits())<br>
}</span><br>
<br>
function&nbsp;lower_mstatus(m&nbsp;:&nbsp;Mstatus)&nbsp;-&gt;&nbsp;Sstatus&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;Mk_Sstatus(zero_extend(0b0));<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_SD(s,&nbsp;m.SD());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;set_sstatus_UXL(s,&nbsp;get_mstatus_UXL(m));<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_MXR(s,&nbsp;m.MXR());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_SUM(s,&nbsp;m.SUM());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_XS(s,&nbsp;m.XS());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_FS(s,&nbsp;m.FS());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_VS(s,&nbsp;m.VS());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_SPP(s,&nbsp;m.SPP());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_SPIE(s,&nbsp;m.SPIE());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_UPIE(s,&nbsp;m.UPIE());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_SIE(s,&nbsp;m.SIE());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_UIE(s,&nbsp;m.UIE());<br>
&nbsp;&nbsp;s<br>
}</span><br>
<br>
function&nbsp;lift_sstatus(m&nbsp;:&nbsp;Mstatus,&nbsp;s&nbsp;:&nbsp;Sstatus)&nbsp;-&gt;&nbsp;Mstatus&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_MXR(m,&nbsp;s.MXR());<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_SUM(m,&nbsp;s.SUM());<br>
<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_XS(m,&nbsp;s.XS());<br>
&nbsp;&nbsp;//&nbsp;See&nbsp;comment&nbsp;for&nbsp;mstatus.FS.<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_FS(m,&nbsp;s.FS());<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_VS(m,&nbsp;s.VS());<br>
&nbsp;&nbsp;let&nbsp;dirty&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">extStatus_of_bits(m.FS())&nbsp;==&nbsp;Dirty&nbsp;|&nbsp;<span style="background-color: hsl(120, 85%, 75%)">extStatus_of_bits(m.XS())&nbsp;==&nbsp;Dirty&nbsp;|<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: hsl(120, 85%, 70%)">extStatus_of_bits(m.VS())&nbsp;==&nbsp;Dirty</span></span></span>;<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_SD(m,&nbsp;bool_to_bits(dirty));<br>
<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_SPP(m,&nbsp;s.SPP());<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_SPIE(m,&nbsp;s.SPIE());<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_UPIE(m,&nbsp;s.UPIE());<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_SIE(m,&nbsp;s.SIE());<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;update_UIE(m,&nbsp;s.UIE());<br>
&nbsp;&nbsp;m<br>
}</span><br>
<br>
function&nbsp;legalize_sstatus(m&nbsp;:&nbsp;Mstatus,&nbsp;v&nbsp;:&nbsp;xlenbits)&nbsp;-&gt;&nbsp;Mstatus&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;legalize_mstatus(m,&nbsp;lift_sstatus(m,&nbsp;Mk_Sstatus(v)).bits())<br>
}</span><br>
<br>
bitfield&nbsp;Sedeleg&nbsp;:&nbsp;xlenbits&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;UEnvCall&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;8,<br>
&nbsp;&nbsp;SAMO_Access_Fault&nbsp;:&nbsp;7,<br>
&nbsp;&nbsp;SAMO_Addr_Align&nbsp;&nbsp;&nbsp;:&nbsp;6,<br>
&nbsp;&nbsp;Load_Access_Fault&nbsp;:&nbsp;5,<br>
&nbsp;&nbsp;Load_Addr_Align&nbsp;&nbsp;&nbsp;:&nbsp;4,<br>
&nbsp;&nbsp;Breakpoint&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;3,<br>
&nbsp;&nbsp;Illegal_Instr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;2,<br>
&nbsp;&nbsp;Fetch_Access_Fault:&nbsp;1,<br>
&nbsp;&nbsp;Fetch_Addr_Align&nbsp;&nbsp;:&nbsp;0<br>
}<br>
register&nbsp;sedeleg&nbsp;:&nbsp;Sedeleg<br>
<br>
function&nbsp;legalize_sedeleg(s&nbsp;:&nbsp;Sedeleg,&nbsp;v&nbsp;:&nbsp;xlenbits)&nbsp;-&gt;&nbsp;Sedeleg&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">{<br>
&nbsp;&nbsp;Mk_Sedeleg(zero_extend(v[8..0]))<br>
}</span><br>
<br>
bitfield&nbsp;Sinterrupts&nbsp;:&nbsp;xlenbits&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;SEI&nbsp;:&nbsp;9,&nbsp;&nbsp;/*&nbsp;external&nbsp;interrupts&nbsp;*/<br>
&nbsp;&nbsp;UEI&nbsp;:&nbsp;8,<br>
<br>
&nbsp;&nbsp;STI&nbsp;:&nbsp;5,&nbsp;&nbsp;/*&nbsp;timers&nbsp;interrupts&nbsp;*/<br>
&nbsp;&nbsp;UTI&nbsp;:&nbsp;4,<br>
<br>
&nbsp;&nbsp;SSI&nbsp;:&nbsp;1,&nbsp;&nbsp;/*&nbsp;software&nbsp;interrupts&nbsp;*/<br>
&nbsp;&nbsp;USI&nbsp;:&nbsp;0<br>
}<br>
<br>
/*&nbsp;Provides&nbsp;the&nbsp;sip&nbsp;read&nbsp;view&nbsp;of&nbsp;mip&nbsp;(m)&nbsp;as&nbsp;delegated&nbsp;by&nbsp;mideleg&nbsp;(d).&nbsp;*/<br>
function&nbsp;lower_mip_to_sip(m&nbsp;:&nbsp;Minterrupts,&nbsp;d&nbsp;:&nbsp;Minterrupts)&nbsp;-&gt;&nbsp;Sinterrupts&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;:&nbsp;Sinterrupts&nbsp;=&nbsp;Mk_Sinterrupts(zero_extend(0b0));<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_SEI(s,&nbsp;m.SEI()&nbsp;&&nbsp;d.SEI());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_STI(s,&nbsp;m.STI()&nbsp;&&nbsp;d.STI());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_SSI(s,&nbsp;m.SSI()&nbsp;&&nbsp;d.SSI());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;haveNExt()&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 75%)">update_UEI(s,&nbsp;m.UEI()&nbsp;&&nbsp;d.UEI())</span>&nbsp;else&nbsp;s</span>;<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;haveNExt()&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 75%)">update_UTI(s,&nbsp;m.UTI()&nbsp;&&nbsp;d.UTI())</span>&nbsp;else&nbsp;s</span>;<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;haveNExt()&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 75%)">update_USI(s,&nbsp;m.USI()&nbsp;&&nbsp;d.USI())</span>&nbsp;else&nbsp;s</span>;<br>
&nbsp;&nbsp;s<br>
}</span><br>
<br>
/*&nbsp;Provides&nbsp;the&nbsp;sie&nbsp;read&nbsp;view&nbsp;of&nbsp;mie&nbsp;(m)&nbsp;as&nbsp;delegated&nbsp;by&nbsp;mideleg&nbsp;(d).&nbsp;*/<br>
function&nbsp;lower_mie(m&nbsp;:&nbsp;Minterrupts,&nbsp;d&nbsp;:&nbsp;Minterrupts)&nbsp;-&gt;&nbsp;Sinterrupts&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;:&nbsp;Sinterrupts&nbsp;=&nbsp;Mk_Sinterrupts(zero_extend(0b0));<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_SEI(s,&nbsp;m.SEI()&nbsp;&&nbsp;d.SEI());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_STI(s,&nbsp;m.STI()&nbsp;&&nbsp;d.STI());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_SSI(s,&nbsp;m.SSI()&nbsp;&&nbsp;d.SSI());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_UEI(s,&nbsp;m.UEI()&nbsp;&&nbsp;d.UEI());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_UTI(s,&nbsp;m.UTI()&nbsp;&&nbsp;d.UTI());<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;update_USI(s,&nbsp;m.USI()&nbsp;&&nbsp;d.USI());<br>
&nbsp;&nbsp;s<br>
}</span><br>
<br>
/*&nbsp;Returns&nbsp;the&nbsp;new&nbsp;value&nbsp;of&nbsp;mip&nbsp;from&nbsp;the&nbsp;previous&nbsp;mip&nbsp;(o)&nbsp;and&nbsp;the&nbsp;written&nbsp;sip&nbsp;(s)&nbsp;as&nbsp;delegated&nbsp;by&nbsp;mideleg&nbsp;(d).&nbsp;*/<br>
function&nbsp;lift_sip(o&nbsp;:&nbsp;Minterrupts,&nbsp;d&nbsp;:&nbsp;Minterrupts,&nbsp;s&nbsp;:&nbsp;Sinterrupts)&nbsp;-&gt;&nbsp;Minterrupts&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;:&nbsp;Minterrupts&nbsp;=&nbsp;o;<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;d.SSI()&nbsp;==&nbsp;0b1&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">update_SSI(m,&nbsp;s.SSI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;haveNExt()&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 75%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 70%)">if&nbsp;d.UEI()&nbsp;==&nbsp;0b1&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 65%)">update_UEI(m,&nbsp;s.UEI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 70%)">if&nbsp;d.USI()&nbsp;==&nbsp;0b1&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 65%)">update_USI(m,&nbsp;s.USI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;m<br>
&nbsp;&nbsp;}</span>&nbsp;else&nbsp;m</span><br>
}</span><br>
<br>
function&nbsp;legalize_sip(m&nbsp;:&nbsp;Minterrupts,&nbsp;d&nbsp;:&nbsp;Minterrupts,&nbsp;v&nbsp;:&nbsp;xlenbits)&nbsp;-&gt;&nbsp;Minterrupts&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;lift_sip(m,&nbsp;d,&nbsp;Mk_Sinterrupts(v))<br>
}</span><br>
<br>
/*&nbsp;Returns&nbsp;the&nbsp;new&nbsp;value&nbsp;of&nbsp;mie&nbsp;from&nbsp;the&nbsp;previous&nbsp;mie&nbsp;(o)&nbsp;and&nbsp;the&nbsp;written&nbsp;sie&nbsp;(s)&nbsp;as&nbsp;delegated&nbsp;by&nbsp;mideleg&nbsp;(d).&nbsp;*/<br>
function&nbsp;lift_sie(o&nbsp;:&nbsp;Minterrupts,&nbsp;d&nbsp;:&nbsp;Minterrupts,&nbsp;s&nbsp;:&nbsp;Sinterrupts)&nbsp;-&gt;&nbsp;Minterrupts&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;:&nbsp;Minterrupts&nbsp;=&nbsp;o;<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;d.SEI()&nbsp;==&nbsp;0b1&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">update_SEI(m,&nbsp;s.SEI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;d.STI()&nbsp;==&nbsp;0b1&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">update_STI(m,&nbsp;s.STI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;d.SSI()&nbsp;==&nbsp;0b1&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">update_SSI(m,&nbsp;s.SSI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;haveNExt()&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 75%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 70%)">if&nbsp;d.UEI()&nbsp;==&nbsp;0b1&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 65%)">update_UEI(m,&nbsp;s.UEI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 70%)">if&nbsp;d.UTI()&nbsp;==&nbsp;0b1&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 65%)">update_UTI(m,&nbsp;s.UTI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;m&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 70%)">if&nbsp;d.USI()&nbsp;==&nbsp;0b1&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 65%)">update_USI(m,&nbsp;s.USI())</span>&nbsp;else&nbsp;m</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;m<br>
&nbsp;&nbsp;}</span>&nbsp;else&nbsp;m</span><br>
}</span><br>
<br>
function&nbsp;legalize_sie(m&nbsp;:&nbsp;Minterrupts,&nbsp;d&nbsp;:&nbsp;Minterrupts,&nbsp;v&nbsp;:&nbsp;xlenbits)&nbsp;-&gt;&nbsp;Minterrupts&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;lift_sie(m,&nbsp;d,&nbsp;Mk_Sinterrupts(v))<br>
}</span><br>
<br>
register&nbsp;sideleg&nbsp;:&nbsp;Sinterrupts<br>
<br>
/*&nbsp;other&nbsp;non-VM&nbsp;related&nbsp;supervisor&nbsp;state&nbsp;*/<br>
register&nbsp;stvec&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;Mtvec<br>
register&nbsp;sscratch&nbsp;:&nbsp;xlenbits<br>
register&nbsp;sepc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;xlenbits<br>
register&nbsp;scause&nbsp;&nbsp;&nbsp;:&nbsp;Mcause<br>
register&nbsp;stval&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;xlenbits<br>
<br>
/*<br>
&nbsp;*&nbsp;S-mode&nbsp;address&nbsp;translation&nbsp;and&nbsp;protection&nbsp;(satp)&nbsp;layout.<br>
&nbsp;*/<br>
<br>
bitfield&nbsp;Satp64&nbsp;:&nbsp;bits(64)&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;Mode&nbsp;:&nbsp;63&nbsp;..&nbsp;60,<br>
&nbsp;&nbsp;Asid&nbsp;:&nbsp;59&nbsp;..&nbsp;44,<br>
&nbsp;&nbsp;PPN&nbsp;&nbsp;:&nbsp;43&nbsp;..&nbsp;0<br>
}<br>
<br>
function&nbsp;legalize_satp64(a&nbsp;:&nbsp;Architecture,&nbsp;o&nbsp;:&nbsp;bits(64),&nbsp;v&nbsp;:&nbsp;bits(64))&nbsp;-&gt;&nbsp;bits(64)&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;s&nbsp;=&nbsp;Mk_Satp64(v);<br>
&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">match&nbsp;satp64Mode_of_bits(a,&nbsp;s.Mode())&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;Some(Bare)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">s.Mode()&nbsp;@&nbsp;zeros(60)</span>,&nbsp;/*&nbsp;remaining&nbsp;fields&nbsp;should&nbsp;be&nbsp;zero&nbsp;when&nbsp;satp.Mode&nbsp;is&nbsp;Bare&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;Some(Sv32)&nbsp;=&gt;&nbsp;o,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Sv32&nbsp;is&nbsp;currently&nbsp;unsupported&nbsp;for&nbsp;satp64&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;Some(Sv39)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">s.bits()</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;Some(Sv48)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">s.bits()</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;Some(Sv57)&nbsp;=&gt;&nbsp;o,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Sv57&nbsp;is&nbsp;not&nbsp;yet&nbsp;implemented&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;o,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;G-stage&nbsp;modes&nbsp;are&nbsp;illegal&nbsp;for&nbsp;satp&nbsp;*/<br>
&nbsp;&nbsp;}</span><br>
}</span><br>
<br>
bitfield&nbsp;Satp32&nbsp;:&nbsp;bits(32)&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;Mode&nbsp;:&nbsp;31,<br>
&nbsp;&nbsp;Asid&nbsp;:&nbsp;30&nbsp;..&nbsp;22,<br>
&nbsp;&nbsp;PPN&nbsp;&nbsp;:&nbsp;21&nbsp;..&nbsp;0<br>
}<br>
<br>
function&nbsp;legalize_satp32(a&nbsp;:&nbsp;Architecture,&nbsp;o&nbsp;:&nbsp;bits(32),&nbsp;v&nbsp;:&nbsp;bits(32))&nbsp;-&gt;&nbsp;bits(32)&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;/*&nbsp;all&nbsp;32-bit&nbsp;satp&nbsp;modes&nbsp;are&nbsp;valid&nbsp;*/<br>
&nbsp;&nbsp;v<br>
}<br>
<br>
/*&nbsp;disabled&nbsp;trigger/debug&nbsp;module&nbsp;*/<br>
register&nbsp;tselect&nbsp;:&nbsp;xlenbits<br>
<br>
/*<br>
&nbsp;*&nbsp;The&nbsp;seed&nbsp;CSR&nbsp;(entropy&nbsp;source)<br>
&nbsp;*&nbsp;------------------------------------------------------------<br>
&nbsp;*/<br>
<br>
/*&nbsp;Valid&nbsp;return&nbsp;states&nbsp;for&nbsp;reading&nbsp;the&nbsp;seed&nbsp;CSR.&nbsp;*/<br>
enum&nbsp;seed_opst&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;BIST,&nbsp;//&nbsp;Built-in-self-test.&nbsp;No&nbsp;randomness&nbsp;sampled.<br>
&nbsp;&nbsp;ES16,&nbsp;//&nbsp;Entropy-sample-16.&nbsp;Valid&nbsp;16-bits&nbsp;of&nbsp;randomness&nbsp;sampled.<br>
&nbsp;&nbsp;WAIT,&nbsp;//&nbsp;Device&nbsp;still&nbsp;gathering&nbsp;entropy.<br>
&nbsp;&nbsp;DEAD&nbsp;&nbsp;//&nbsp;Fatal&nbsp;device&nbsp;compromise.&nbsp;No&nbsp;randomness&nbsp;sampled.<br>
}<br>
<br>
/*&nbsp;Mapping&nbsp;of&nbsp;status&nbsp;codes&nbsp;and&nbsp;their&nbsp;actual&nbsp;encodings.&nbsp;*/<br>
mapping&nbsp;opst_code&nbsp;:&nbsp;seed_opst&nbsp;&lt;-&gt;&nbsp;bits(2)&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;BIST&nbsp;&lt;-&gt;&nbsp;0b00,<br>
&nbsp;&nbsp;WAIT&nbsp;&lt;-&gt;&nbsp;0b01,<br>
&nbsp;&nbsp;ES16&nbsp;&lt;-&gt;&nbsp;0b10,<br>
&nbsp;&nbsp;DEAD&nbsp;&lt;-&gt;&nbsp;0b11<br>
}<br>
<br>
/*<br>
&nbsp;*&nbsp;Entropy&nbsp;Source&nbsp;-&nbsp;Platform&nbsp;access&nbsp;to&nbsp;random&nbsp;bits.<br>
&nbsp;*&nbsp;WARNING:&nbsp;This&nbsp;function&nbsp;currently&nbsp;lacks&nbsp;a&nbsp;proper&nbsp;side-effect&nbsp;annotation.<br>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;you&nbsp;are&nbsp;using&nbsp;theorem&nbsp;prover&nbsp;tool&nbsp;flows,&nbsp;you<br>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;may&nbsp;need&nbsp;to&nbsp;modify&nbsp;or&nbsp;stub&nbsp;out&nbsp;this&nbsp;function&nbsp;for&nbsp;now.<br>
&nbsp;*&nbsp;NOTE:&nbsp;This&nbsp;would&nbsp;be&nbsp;better&nbsp;placed&nbsp;in&nbsp;riscv_platform.sail,&nbsp;but&nbsp;that&nbsp;file<br>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;appears&nbsp;_after_&nbsp;this&nbsp;one&nbsp;in&nbsp;the&nbsp;compile&nbsp;order&nbsp;meaning&nbsp;the&nbsp;valspec<br>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;this&nbsp;function&nbsp;is&nbsp;unavailable&nbsp;when&nbsp;it's&nbsp;first&nbsp;encountered&nbsp;in<br>
&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read_seed_csr.&nbsp;Hence&nbsp;it&nbsp;appears&nbsp;here.<br>
&nbsp;*/<br>
val&nbsp;get_16_random_bits&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;ocaml:&nbsp;&quot;Platform.get_16_random_bits&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;interpreter:&nbsp;&quot;Platform.get_16_random_bits&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;c:&nbsp;&quot;plat_get_16_random_bits&quot;,<br>
&nbsp;&nbsp;&nbsp;&nbsp;lem:&nbsp;&quot;plat_get_16_random_bits&quot;<br>
}&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;bits(16)<br>
<br>
/*&nbsp;Entropy&nbsp;source&nbsp;spec&nbsp;requires&nbsp;an&nbsp;Illegal&nbsp;opcode&nbsp;exception&nbsp;be&nbsp;raised&nbsp;if&nbsp;the<br>
&nbsp;*&nbsp;seed&nbsp;register&nbsp;is&nbsp;read&nbsp;without&nbsp;also&nbsp;being&nbsp;written.&nbsp;This&nbsp;function&nbsp;is&nbsp;only<br>
&nbsp;*&nbsp;called&nbsp;once&nbsp;we&nbsp;know&nbsp;the&nbsp;CSR&nbsp;is&nbsp;being&nbsp;written,&nbsp;and&nbsp;all&nbsp;other&nbsp;access&nbsp;control<br>
&nbsp;*&nbsp;checks&nbsp;have&nbsp;been&nbsp;done.<br>
&nbsp;*/<br>
function&nbsp;read_seed_csr()&nbsp;-&gt;&nbsp;xlenbits&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;reserved_bits&nbsp;:&nbsp;bits(6)&nbsp;=&nbsp;0b000000;<br>
&nbsp;&nbsp;let&nbsp;custom_bits&nbsp;:&nbsp;bits(8)&nbsp;=&nbsp;0x00;<br>
&nbsp;&nbsp;let&nbsp;seed&nbsp;:&nbsp;bits(16)&nbsp;=&nbsp;get_16_random_bits();<br>
&nbsp;&nbsp;zero_extend(opst_code(ES16)&nbsp;@&nbsp;reserved_bits&nbsp;@&nbsp;custom_bits&nbsp;@&nbsp;seed)<br>
}</span><br>
<br>
/*&nbsp;Writes&nbsp;to&nbsp;the&nbsp;seed&nbsp;CSR&nbsp;are&nbsp;ignored&nbsp;*/<br>
function&nbsp;write_seed_csr&nbsp;()&nbsp;-&gt;&nbsp;option(xlenbits)&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">None()</span><br>
<br>
//&nbsp;menvcfg&nbsp;is&nbsp;64&nbsp;bits.&nbsp;senvcfg&nbsp;is&nbsp;SXLEN&nbsp;bits&nbsp;and&nbsp;does&nbsp;not&nbsp;have&nbsp;the&nbsp;two<br>
//&nbsp;upper&nbsp;fields&nbsp;so&nbsp;for&nbsp;simplicity&nbsp;we&nbsp;can&nbsp;use&nbsp;the&nbsp;same&nbsp;type.<br>
bitfield&nbsp;Envcfg&nbsp;:&nbsp;bits(64)&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;//&nbsp;Supervisor&nbsp;TimeCmp&nbsp;Extension<br>
&nbsp;&nbsp;STCE&nbsp;&nbsp;&nbsp;:&nbsp;63,<br>
&nbsp;&nbsp;//&nbsp;Page&nbsp;Based&nbsp;Memory&nbsp;Types&nbsp;Extension<br>
&nbsp;&nbsp;PBMTE&nbsp;&nbsp;:&nbsp;62,<br>
&nbsp;&nbsp;//&nbsp;Reserved&nbsp;WPRI&nbsp;bits.<br>
&nbsp;&nbsp;wpri_1&nbsp;:&nbsp;61&nbsp;..&nbsp;8,<br>
&nbsp;&nbsp;//&nbsp;Cache&nbsp;Block&nbsp;Zero&nbsp;instruction&nbsp;Enable<br>
&nbsp;&nbsp;CBZE&nbsp;&nbsp;&nbsp;:&nbsp;7,<br>
&nbsp;&nbsp;//&nbsp;Cache&nbsp;Block&nbsp;Clean&nbsp;and&nbsp;Flush&nbsp;instruction&nbsp;Enable<br>
&nbsp;&nbsp;CBCFE&nbsp;&nbsp;:&nbsp;6,<br>
&nbsp;&nbsp;//&nbsp;Cache&nbsp;Block&nbsp;Invalidate&nbsp;instruction&nbsp;Enable<br>
&nbsp;&nbsp;CBIE&nbsp;&nbsp;&nbsp;:&nbsp;5&nbsp;..&nbsp;4,<br>
&nbsp;&nbsp;//&nbsp;Reserved&nbsp;WPRI&nbsp;bits.<br>
&nbsp;&nbsp;wpri_0&nbsp;:&nbsp;3&nbsp;..&nbsp;1,<br>
&nbsp;&nbsp;//&nbsp;Fence&nbsp;of&nbsp;I/O&nbsp;implies&nbsp;Memory<br>
&nbsp;&nbsp;FIOM&nbsp;&nbsp;&nbsp;:&nbsp;0,<br>
}<br>
<br>
register&nbsp;menvcfg&nbsp;:&nbsp;Envcfg<br>
register&nbsp;senvcfg&nbsp;:&nbsp;Envcfg<br>
<br>
function&nbsp;legalize_envcfg(o&nbsp;:&nbsp;Envcfg,&nbsp;v&nbsp;:&nbsp;bits(64))&nbsp;-&gt;&nbsp;Envcfg&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;v&nbsp;=&nbsp;Mk_Envcfg(v);<br>
&nbsp;&nbsp;let&nbsp;o&nbsp;=&nbsp;update_FIOM(o,&nbsp;<span style="background-color: hsl(0, 85%, 75%)">if&nbsp;sys_enable_writable_fiom()&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 70%)">v.FIOM()</span>&nbsp;else&nbsp;<span style="background-color: hsl(0, 85%, 70%)">0b0</span></span>);<br>
&nbsp;&nbsp;//&nbsp;Other&nbsp;extensions&nbsp;are&nbsp;not&nbsp;implemented&nbsp;yet&nbsp;so&nbsp;all&nbsp;other&nbsp;fields&nbsp;are&nbsp;read&nbsp;only&nbsp;zero.<br>
&nbsp;&nbsp;o<br>
}</span><br>
<br>
/*&nbsp;vector&nbsp;csrs&nbsp;*/<br>
register&nbsp;vstart&nbsp;:&nbsp;bits(16)&nbsp;/*&nbsp;use&nbsp;the&nbsp;largest&nbsp;possible&nbsp;length&nbsp;of&nbsp;vstart&nbsp;*/<br>
register&nbsp;vxsat&nbsp;&nbsp;:&nbsp;bits(1)<br>
register&nbsp;vxrm&nbsp;&nbsp;&nbsp;:&nbsp;bits(2)<br>
register&nbsp;vl&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;xlenbits<br>
register&nbsp;vlenb&nbsp;&nbsp;:&nbsp;xlenbits<br>
<br>
bitfield&nbsp;Vtype&nbsp;&nbsp;:&nbsp;xlenbits&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;vill&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;xlen&nbsp;-&nbsp;1,<br>
&nbsp;&nbsp;reserved&nbsp;&nbsp;:&nbsp;xlen&nbsp;-&nbsp;2&nbsp;..&nbsp;8,<br>
&nbsp;&nbsp;vma&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;7,<br>
&nbsp;&nbsp;vta&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;6,<br>
&nbsp;&nbsp;vsew&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;5&nbsp;..&nbsp;3,<br>
&nbsp;&nbsp;vlmul&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;2&nbsp;..&nbsp;0<br>
}<br>
register&nbsp;vtype&nbsp;:&nbsp;Vtype<br>
<br>
/*&nbsp;the&nbsp;dynamic&nbsp;selected&nbsp;element&nbsp;width&nbsp;(SEW)&nbsp;*/<br>
/*&nbsp;this&nbsp;returns&nbsp;the&nbsp;power&nbsp;of&nbsp;2&nbsp;for&nbsp;SEW&nbsp;*/<br>
val&nbsp;get_sew_pow&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;{|3,&nbsp;4,&nbsp;5,&nbsp;6|}<br>
function&nbsp;get_sew_pow()&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;SEW_pow&nbsp;:&nbsp;{|3,&nbsp;4,&nbsp;5,&nbsp;6|}&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 75%)">match&nbsp;vtype.vsew()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;0b000&nbsp;=&gt;&nbsp;3,<br>
&nbsp;&nbsp;&nbsp;&nbsp;0b001&nbsp;=&gt;&nbsp;4,<br>
&nbsp;&nbsp;&nbsp;&nbsp;0b010&nbsp;=&gt;&nbsp;5,<br>
&nbsp;&nbsp;&nbsp;&nbsp;0b011&nbsp;=&gt;&nbsp;6,<br>
&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 70%)">{assert(false,&nbsp;&quot;invalid&nbsp;vsew&nbsp;field&nbsp;in&nbsp;vtype&quot;);&nbsp;0}</span><br>
&nbsp;&nbsp;}</span>;<br>
&nbsp;&nbsp;SEW_pow<br>
}</span><br>
/*&nbsp;this&nbsp;returns&nbsp;the&nbsp;actual&nbsp;value&nbsp;of&nbsp;SEW&nbsp;*/<br>
val&nbsp;get_sew&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;{|8,&nbsp;16,&nbsp;32,&nbsp;64|}<br>
function&nbsp;get_sew()&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">{<br>
&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 75%)">match&nbsp;get_sew_pow()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;=&gt;&nbsp;8,<br>
&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 70%)">16</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 70%)">32</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 70%)">64</span><br>
&nbsp;&nbsp;}</span><br>
}</span><br>
/*&nbsp;this&nbsp;returns&nbsp;the&nbsp;value&nbsp;of&nbsp;SEW&nbsp;in&nbsp;bytes&nbsp;*/<br>
val&nbsp;get_sew_bytes&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;{|1,&nbsp;2,&nbsp;4,&nbsp;8|}<br>
function&nbsp;get_sew_bytes()&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">{<br>
&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 75%)">match&nbsp;get_sew_pow()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;=&gt;&nbsp;1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;=&gt;&nbsp;2,<br>
&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;=&gt;&nbsp;4,<br>
&nbsp;&nbsp;&nbsp;&nbsp;6&nbsp;=&gt;&nbsp;8<br>
&nbsp;&nbsp;}</span><br>
}</span><br>
<br>
/*&nbsp;the&nbsp;vector&nbsp;register&nbsp;group&nbsp;multiplier&nbsp;(LMUL)&nbsp;*/<br>
/*&nbsp;this&nbsp;returns&nbsp;the&nbsp;power&nbsp;of&nbsp;2&nbsp;for&nbsp;LMUL&nbsp;*/<br>
val&nbsp;get_lmul_pow&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;{|-3,&nbsp;-2,&nbsp;-1,&nbsp;0,&nbsp;1,&nbsp;2,&nbsp;3|}<br>
function&nbsp;get_lmul_pow()&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">{<br>
&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 75%)">match&nbsp;vtype.vlmul()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;0b101&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 70%)">-3</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;0b110&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 70%)">-2</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;0b111&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 70%)">-1</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;0b000&nbsp;=&gt;&nbsp;0,<br>
&nbsp;&nbsp;&nbsp;&nbsp;0b001&nbsp;=&gt;&nbsp;1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;0b010&nbsp;=&gt;&nbsp;2,<br>
&nbsp;&nbsp;&nbsp;&nbsp;0b011&nbsp;=&gt;&nbsp;3,<br>
&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 70%)">{assert(false,&nbsp;&quot;invalid&nbsp;vlmul&nbsp;field&nbsp;in&nbsp;vtype&quot;);&nbsp;0}</span><br>
&nbsp;&nbsp;}</span><br>
}</span><br>
<br>
enum&nbsp;agtype&nbsp;=&nbsp;{&nbsp;UNDISTURBED,&nbsp;AGNOSTIC&nbsp;}<br>
<br>
val&nbsp;decode_agtype&nbsp;:&nbsp;bits(1)&nbsp;-&gt;&nbsp;agtype<br>
function&nbsp;decode_agtype(ag)&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">{<br>
&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 75%)">match&nbsp;ag&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;0b0&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 70%)">UNDISTURBED</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;0b1&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 70%)">AGNOSTIC</span><br>
&nbsp;&nbsp;}</span><br>
}</span><br>
<br>
val&nbsp;get_vtype_vma&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;agtype<br>
function&nbsp;get_vtype_vma()&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">decode_agtype(vtype.vma())</span><br>
<br>
val&nbsp;get_vtype_vta&nbsp;:&nbsp;unit&nbsp;-&gt;&nbsp;agtype<br>
function&nbsp;get_vtype_vta()&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">decode_agtype(vtype.vta())</span><br>
</code>
</body>
</html>
