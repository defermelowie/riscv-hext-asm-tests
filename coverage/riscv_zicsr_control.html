<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>riscv_zicsr_control</title></head>
<body>
<h1>riscv_zicsr_control.sail (88/170) 52%</h1>
<code style="display: block">
/*&nbsp;CSR&nbsp;access&nbsp;control&nbsp;*/<br>
<br>
function&nbsp;csrAccess(csr&nbsp;:&nbsp;csreg)&nbsp;-&gt;&nbsp;csrRW&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">csr[11..10]</span><br>
function&nbsp;csrPriv(csr&nbsp;:&nbsp;csreg)&nbsp;-&gt;&nbsp;priv_level&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">csr[9..8]</span><br>
<br>
function&nbsp;is_CSR_defined&nbsp;(csr&nbsp;:&nbsp;csreg,&nbsp;p&nbsp;:&nbsp;Privilege)&nbsp;-&gt;&nbsp;bool&nbsp;=<br>
&nbsp;&nbsp;<span style="background-color: hsl(120, 85%, 80%)">match&nbsp;(csr)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;machine&nbsp;mode:&nbsp;informational&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;0xf11&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;mvendorid<br>
&nbsp;&nbsp;&nbsp;&nbsp;0xf12&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;marchdid<br>
&nbsp;&nbsp;&nbsp;&nbsp;0xf13&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;mimpid<br>
&nbsp;&nbsp;&nbsp;&nbsp;0xf14&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;mhartid<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;machine&nbsp;mode:&nbsp;trap&nbsp;setup&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x300&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;mstatus<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x301&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;misa<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x302&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 70%)">haveSupMode()&nbsp;|&nbsp;<span style="background-color: hsl(0, 85%, 80%)">haveNExt()</span></span>)</span>,&nbsp;//&nbsp;medeleg<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x303&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 70%)">haveSupMode()&nbsp;|&nbsp;<span style="background-color: hsl(0, 85%, 80%)">haveNExt()</span></span>)</span>,&nbsp;//&nbsp;mideleg<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x304&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;mie<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x305&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;mtvec<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x306&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 70%)">haveUsrMode()</span></span>,&nbsp;//&nbsp;mcounteren<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x30A&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine&nbsp;&&nbsp;<span style="background-color: hsl(0, 85%, 75%)">haveUsrMode()</span></span>,&nbsp;//&nbsp;menvcfg<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x310&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine&nbsp;&&nbsp;(sizeof(xlen)&nbsp;==&nbsp;32)</span>,&nbsp;//&nbsp;mstatush<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x31A&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine&nbsp;&&nbsp;<span style="background-color: hsl(0, 85%, 75%)">haveUsrMode()&nbsp;&&nbsp;(sizeof(xlen)&nbsp;==&nbsp;32)</span></span>,&nbsp;//&nbsp;menvcfgh<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x320&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;mcountinhibit<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;machine&nbsp;mode:&nbsp;trap&nbsp;handling&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x340&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;mscratch<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x341&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;mepc<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x342&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;mcause<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x343&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;mtval<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x344&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;mip<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3A0&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;pmpcfg0<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3A1&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine&nbsp;&&nbsp;(sizeof(xlen)&nbsp;==&nbsp;32)</span>,&nbsp;//&nbsp;pmpcfg1<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3A2&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;pmpcfg2<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3A3&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine&nbsp;&&nbsp;(sizeof(xlen)&nbsp;==&nbsp;32)</span>,&nbsp;//&nbsp;pmpcfg3<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3B0&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;pmpaddr0<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3B1&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;pmpaddr1<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3B2&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;pmpaddr2<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3B3&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;pmpaddr3<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3B4&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;pmpaddr4<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3B5&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;pmpaddr5<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3B6&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;pmpaddr6<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3B7&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;pmpaddr7<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3B8&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;pmpaddr8<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3B9&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;pmpaddr9<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3BA&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;pmpaddrA<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3BB&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;pmpaddrB<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3BC&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;pmpaddrC<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3BD&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;pmpaddrD<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3BE&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;pmpaddrE<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x3BF&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;pmpaddrF<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;counters&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;0xB00&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;mcycle<br>
&nbsp;&nbsp;&nbsp;&nbsp;0xB02&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,&nbsp;//&nbsp;minstret<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;0xB80&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">p&nbsp;==&nbsp;Machine&nbsp;&&nbsp;(sizeof(xlen)&nbsp;==&nbsp;32)</span>,&nbsp;//&nbsp;mcycleh<br>
&nbsp;&nbsp;&nbsp;&nbsp;0xB82&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine&nbsp;&&nbsp;(sizeof(xlen)&nbsp;==&nbsp;32)</span>,&nbsp;//&nbsp;minstreth<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;disabled&nbsp;trigger/debug&nbsp;module&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x7a0&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Machine</span>,<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;supervisor&nbsp;mode:&nbsp;trap&nbsp;setup&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x100&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">haveSupMode()&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 70%)">p&nbsp;==&nbsp;Machine&nbsp;|&nbsp;<span style="background-color: hsl(120, 85%, 65%)">p&nbsp;==&nbsp;Supervisor</span></span>)</span>,&nbsp;//&nbsp;sstatus<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x102&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">haveSupMode()&nbsp;&&nbsp;<span style="background-color: hsl(0, 85%, 75%)">haveNExt()&nbsp;&&nbsp;(<span style="background-color: hsl(0, 85%, 70%)">p&nbsp;==&nbsp;Machine&nbsp;|&nbsp;<span style="background-color: hsl(0, 85%, 65%)">p&nbsp;==&nbsp;Supervisor</span></span>)</span></span>,&nbsp;//&nbsp;sedeleg<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x103&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">haveSupMode()&nbsp;&&nbsp;<span style="background-color: hsl(0, 85%, 75%)">haveNExt()&nbsp;&&nbsp;(<span style="background-color: hsl(0, 85%, 70%)">p&nbsp;==&nbsp;Machine&nbsp;|&nbsp;<span style="background-color: hsl(0, 85%, 65%)">p&nbsp;==&nbsp;Supervisor</span></span>)</span></span>,&nbsp;//&nbsp;sideleg<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x104&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">haveSupMode()&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 70%)">p&nbsp;==&nbsp;Machine&nbsp;|&nbsp;<span style="background-color: hsl(120, 85%, 65%)">p&nbsp;==&nbsp;Supervisor</span></span>)</span>,&nbsp;//&nbsp;sie<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x105&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">haveSupMode()&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 70%)">p&nbsp;==&nbsp;Machine&nbsp;|&nbsp;<span style="background-color: hsl(120, 85%, 65%)">p&nbsp;==&nbsp;Supervisor</span></span>)</span>,&nbsp;//&nbsp;stvec<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x106&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">haveSupMode()&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 70%)">p&nbsp;==&nbsp;Machine&nbsp;|&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Supervisor</span></span>)</span>,&nbsp;//&nbsp;scounteren<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x10A&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">haveSupMode()&nbsp;&&nbsp;(<span style="background-color: hsl(0, 85%, 75%)">p&nbsp;==&nbsp;Machine&nbsp;|&nbsp;<span style="background-color: hsl(0, 85%, 70%)">p&nbsp;==&nbsp;Supervisor</span></span>)</span>,&nbsp;//&nbsp;senvcfg<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;supervisor&nbsp;mode:&nbsp;trap&nbsp;handling&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x140&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">haveSupMode()&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 70%)">p&nbsp;==&nbsp;Machine&nbsp;|&nbsp;<span style="background-color: hsl(120, 85%, 65%)">p&nbsp;==&nbsp;Supervisor</span></span>)</span>,&nbsp;//&nbsp;sscratch<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x141&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">haveSupMode()&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 70%)">p&nbsp;==&nbsp;Machine&nbsp;|&nbsp;<span style="background-color: hsl(120, 85%, 65%)">p&nbsp;==&nbsp;Supervisor</span></span>)</span>,&nbsp;//&nbsp;sepc<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x142&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">haveSupMode()&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 70%)">p&nbsp;==&nbsp;Machine&nbsp;|&nbsp;<span style="background-color: hsl(120, 85%, 65%)">p&nbsp;==&nbsp;Supervisor</span></span>)</span>,&nbsp;//&nbsp;scause<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x143&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">haveSupMode()&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 70%)">p&nbsp;==&nbsp;Machine&nbsp;|&nbsp;<span style="background-color: hsl(120, 85%, 65%)">p&nbsp;==&nbsp;Supervisor</span></span>)</span>,&nbsp;//&nbsp;stval<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x144&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">haveSupMode()&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 70%)">p&nbsp;==&nbsp;Machine&nbsp;|&nbsp;<span style="background-color: hsl(120, 85%, 65%)">p&nbsp;==&nbsp;Supervisor</span></span>)</span>,&nbsp;//&nbsp;sip<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;supervisor&nbsp;mode:&nbsp;address&nbsp;translation&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x180&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">haveSupMode()&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 70%)">p&nbsp;==&nbsp;Machine&nbsp;|&nbsp;<span style="background-color: hsl(0, 85%, 80%)">p&nbsp;==&nbsp;Supervisor</span></span>)</span>,&nbsp;//&nbsp;satp<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;user&nbsp;mode:&nbsp;counters&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;0xC00&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">haveUsrMode()</span>,&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;cycle<br>
&nbsp;&nbsp;&nbsp;&nbsp;0xC01&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">haveUsrMode()</span>,&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;time<br>
&nbsp;&nbsp;&nbsp;&nbsp;0xC02&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">haveUsrMode()</span>,&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;instret<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;0xC80&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">haveUsrMode()&nbsp;&&nbsp;(sizeof(xlen)&nbsp;==&nbsp;32)</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;cycleh<br>
&nbsp;&nbsp;&nbsp;&nbsp;0xC81&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">haveUsrMode()&nbsp;&&nbsp;(sizeof(xlen)&nbsp;==&nbsp;32)</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;timeh<br>
&nbsp;&nbsp;&nbsp;&nbsp;0xC82&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">haveUsrMode()&nbsp;&&nbsp;(sizeof(xlen)&nbsp;==&nbsp;32)</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;instreth<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;user&nbsp;mode:&nbsp;Zkr&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;0x015&nbsp;=&gt;&nbsp;haveZkr(),<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;check&nbsp;extensions&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">ext_is_CSR_defined(csr,&nbsp;p)</span><br>
&nbsp;&nbsp;}</span><br>
<br>
val&nbsp;check_CSR_access&nbsp;:&nbsp;(csrRW,&nbsp;priv_level,&nbsp;Privilege,&nbsp;Virtualization,&nbsp;bool)&nbsp;-&gt;&nbsp;bool<br>
function&nbsp;check_CSR_access(csrrw,&nbsp;csrpr,&nbsp;p,&nbsp;v,&nbsp;isWrite)&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;let&nbsp;check_priv:&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(0, 85%, 80%)">match&nbsp;p&nbsp;{&nbsp;/*&nbsp;privilege&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;Machine&nbsp;=&gt;&nbsp;(<span style="background-color: hsl(120, 85%, 75%)">privLevel_to_bits(Machine)&nbsp;&gt;=_u&nbsp;csrpr</span>),<br>
&nbsp;&nbsp;&nbsp;&nbsp;Supervisor&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">match&nbsp;v&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V0&nbsp;=&gt;&nbsp;(<span style="background-color: hsl(120, 85%, 70%)">0b10&gt;=_u&nbsp;csrpr</span>),&nbsp;/*&nbsp;hypervisor&nbsp;CSRs&nbsp;(0b10)&nbsp;are&nbsp;accessible&nbsp;in&nbsp;HS-mode&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V1&nbsp;=&gt;&nbsp;(<span style="background-color: hsl(120, 85%, 70%)">privLevel_to_bits(Supervisor)&nbsp;&gt;=_u&nbsp;csrpr</span>)}</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;User&nbsp;=&gt;&nbsp;(<span style="background-color: hsl(120, 85%, 75%)">privLevel_to_bits(User)&nbsp;&gt;=_u&nbsp;csrpr</span>),<br>
&nbsp;&nbsp;}</span>;<br>
&nbsp;&nbsp;let&nbsp;check_RW&nbsp;=&nbsp;not(<span style="background-color: hsl(0, 85%, 80%)">isWrite&nbsp;==&nbsp;true&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 75%)">csrrw&nbsp;==&nbsp;0b11</span></span>);&nbsp;&nbsp;/*&nbsp;read/write&nbsp;*/<br>
&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">check_priv&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 75%)">check_RW</span></span><br>
}</span><br>
<br>
function&nbsp;check_TVM_SATP(csr&nbsp;:&nbsp;csreg,&nbsp;p&nbsp;:&nbsp;Privilege,&nbsp;v:&nbsp;Virtualization)&nbsp;-&gt;&nbsp;bool&nbsp;=<br>
&nbsp;&nbsp;<span style="background-color: hsl(120, 85%, 80%)">match&nbsp;(p,&nbsp;v)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;(Supervisor,&nbsp;V0)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">not(<span style="background-color: hsl(0, 85%, 80%)">csr&nbsp;==&nbsp;0x180&nbsp;&&nbsp;<span style="background-color: hsl(0, 85%, 75%)">mstatus.TVM()&nbsp;==&nbsp;0b1</span></span>)</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;(Supervisor,&nbsp;V1)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">not(<span style="background-color: hsl(0, 85%, 80%)">csr&nbsp;==&nbsp;0x180&nbsp;&&nbsp;<span style="background-color: hsl(0, 85%, 75%)">hstatus.VTVM()&nbsp;==&nbsp;0b1</span></span>)</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;(_,&nbsp;_)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">true</span><br>
&nbsp;&nbsp;}</span><br>
<br>
function&nbsp;check_Counteren(csr&nbsp;:&nbsp;csreg,&nbsp;p&nbsp;:&nbsp;Privilege,&nbsp;v&nbsp;:&nbsp;Virtualization)&nbsp;-&gt;&nbsp;bool&nbsp;=<br>
&nbsp;&nbsp;<span style="background-color: hsl(120, 85%, 80%)">match(csr,&nbsp;p,&nbsp;v)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;(0xC00,&nbsp;Supervisor,&nbsp;V0)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">mcounteren.CY()&nbsp;==&nbsp;0b1</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;(0xC01,&nbsp;Supervisor,&nbsp;V0)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">mcounteren.TM()&nbsp;==&nbsp;0b1</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;(0xC02,&nbsp;Supervisor,&nbsp;V0)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">mcounteren.IR()&nbsp;==&nbsp;0b1</span>,<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;(0xC00,&nbsp;Supervisor,&nbsp;V1)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">mcounteren.CY()&nbsp;==&nbsp;0b1&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 70%)">hcounteren.CY()&nbsp;==&nbsp;0b1</span></span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;(0xC01,&nbsp;Supervisor,&nbsp;V1)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">mcounteren.TM()&nbsp;==&nbsp;0b1&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 70%)">hcounteren.TM()&nbsp;==&nbsp;0b1</span></span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;(0xC02,&nbsp;Supervisor,&nbsp;V1)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">mcounteren.IR()&nbsp;==&nbsp;0b1&nbsp;&&nbsp;<span style="background-color: hsl(0, 85%, 75%)">hcounteren.IR()&nbsp;==&nbsp;0b1</span></span>,<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;(0xC00,&nbsp;User,&nbsp;VO)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">mcounteren.CY()&nbsp;==&nbsp;0b1&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 70%)">not(haveSupMode())&nbsp;|&nbsp;<span style="background-color: hsl(120, 85%, 65%)">scounteren.CY()&nbsp;==&nbsp;0b1</span></span>)</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;(0xC01,&nbsp;User,&nbsp;VO)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">mcounteren.TM()&nbsp;==&nbsp;0b1&nbsp;&&nbsp;(<span style="background-color: hsl(120, 85%, 70%)">not(haveSupMode())&nbsp;|&nbsp;<span style="background-color: hsl(120, 85%, 65%)">scounteren.TM()&nbsp;==&nbsp;0b1</span></span>)</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;(0xC02,&nbsp;User,&nbsp;VO)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">mcounteren.IR()&nbsp;==&nbsp;0b1&nbsp;&&nbsp;(<span style="background-color: hsl(0, 85%, 75%)">not(haveSupMode())&nbsp;|&nbsp;<span style="background-color: hsl(0, 85%, 70%)">scounteren.IR()&nbsp;==&nbsp;0b1</span></span>)</span>,<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Note:&nbsp;S-mode&nbsp;is&nbsp;always&nbsp;present&nbsp;when&nbsp;H-ext&nbsp;is&nbsp;implemented<br>
&nbsp;&nbsp;&nbsp;&nbsp;(0xC00,&nbsp;User,&nbsp;V1)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">mcounteren.CY()&nbsp;==&nbsp;0b1&nbsp;&&nbsp;<span style="background-color: hsl(0, 85%, 75%)">hcounteren.CY()&nbsp;==&nbsp;0b1&nbsp;&&nbsp;<span style="background-color: hsl(0, 85%, 70%)">scounteren.CY()&nbsp;==&nbsp;0b1</span></span></span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;(0xC01,&nbsp;User,&nbsp;V1)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">mcounteren.TM()&nbsp;==&nbsp;0b1&nbsp;&&nbsp;<span style="background-color: hsl(0, 85%, 75%)">hcounteren.TM()&nbsp;==&nbsp;0b1&nbsp;&&nbsp;<span style="background-color: hsl(0, 85%, 70%)">scounteren.TM()&nbsp;==&nbsp;0b1</span></span></span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;(0xC02,&nbsp;User,&nbsp;V1)&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">mcounteren.IR()&nbsp;==&nbsp;0b1&nbsp;&&nbsp;<span style="background-color: hsl(0, 85%, 75%)">hcounteren.IR()&nbsp;==&nbsp;0b1&nbsp;&&nbsp;<span style="background-color: hsl(0, 85%, 70%)">scounteren.IR()&nbsp;==&nbsp;0b1</span></span></span>,<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;no&nbsp;HPM&nbsp;counters&nbsp;for&nbsp;now&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;(_,&nbsp;_,&nbsp;_)&nbsp;=&gt;&nbsp;//&nbsp;Note:&nbsp;would&nbsp;be&nbsp;more&nbsp;elegant&nbsp;if&nbsp;matching&nbsp;on&nbsp;ranges&nbsp;was&nbsp;supported<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: hsl(120, 85%, 75%)">if&nbsp;&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">0xC03&nbsp;&lt;=_u&nbsp;csr&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 70%)">csr&nbsp;&lt;=_u&nbsp;0xC1F</span></span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 80%)">false</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;<span style="background-color: hsl(120, 85%, 70%)">true</span></span><br>
&nbsp;&nbsp;}</span><br>
<br>
<br>
/*&nbsp;Seed&nbsp;may&nbsp;only&nbsp;be&nbsp;accessed&nbsp;if&nbsp;we&nbsp;are&nbsp;doing&nbsp;a&nbsp;write,&nbsp;and&nbsp;access&nbsp;has&nbsp;been<br>
&nbsp;*&nbsp;allowed&nbsp;in&nbsp;the&nbsp;current&nbsp;priv&nbsp;mode<br>
&nbsp;*/<br>
function&nbsp;check_seed_CSR&nbsp;(csr&nbsp;:&nbsp;csreg,&nbsp;p&nbsp;:&nbsp;Privilege,&nbsp;isWrite&nbsp;:&nbsp;bool)&nbsp;-&gt;&nbsp;bool&nbsp;=&nbsp;<span style="background-color: hsl(120, 85%, 80%)">{<br>
&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 80%)">if&nbsp;not(csr&nbsp;==&nbsp;0x015)&nbsp;then&nbsp;<span style="background-color: hsl(120, 85%, 75%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;true<br>
&nbsp;&nbsp;}</span>&nbsp;else&nbsp;<span style="background-color: hsl(0, 85%, 75%)">if&nbsp;not(isWrite)&nbsp;then&nbsp;<span style="background-color: hsl(0, 85%, 70%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Read-only&nbsp;access&nbsp;to&nbsp;the&nbsp;seed&nbsp;CSR&nbsp;is&nbsp;not&nbsp;allowed&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;false<br>
&nbsp;&nbsp;}</span>&nbsp;else&nbsp;<span style="background-color: hsl(0, 85%, 70%)">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: hsl(0, 85%, 65%)">match&nbsp;(p)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Machine&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 60%)">true</span>,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Supervisor&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 60%)">false</span>,&nbsp;/*&nbsp;TODO:&nbsp;base&nbsp;this&nbsp;on&nbsp;mseccfg&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;User&nbsp;=&gt;&nbsp;<span style="background-color: hsl(0, 85%, 60%)">false</span>,&nbsp;/*&nbsp;TODO:&nbsp;base&nbsp;this&nbsp;on&nbsp;mseccfg&nbsp;*/<br>
&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
&nbsp;&nbsp;}</span></span></span><br>
}</span><br>
<br>
function&nbsp;check_CSR(csr&nbsp;:&nbsp;csreg,&nbsp;p&nbsp;:&nbsp;Privilege,&nbsp;v:&nbsp;Virtualization,&nbsp;isWrite&nbsp;:&nbsp;bool)&nbsp;-&gt;&nbsp;bool&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="background-color: hsl(120, 85%, 80%)">is_CSR_defined(csr,&nbsp;p)<br>
&nbsp;&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 75%)">check_CSR_access(csrAccess(csr),&nbsp;csrPriv(csr),&nbsp;p,&nbsp;v,&nbsp;isWrite)<br>
&nbsp;&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 70%)">check_TVM_SATP(csr,&nbsp;p,&nbsp;v)<br>
&nbsp;&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 65%)">check_Counteren(csr,&nbsp;p,&nbsp;v)<br>
&nbsp;&nbsp;&&nbsp;<span style="background-color: hsl(120, 85%, 60%)">check_seed_CSR(csr,&nbsp;p,&nbsp;isWrite)</span></span></span></span></span><br>
</code>
</body>
</html>
